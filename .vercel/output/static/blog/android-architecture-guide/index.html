<!DOCTYPE html><html lang="en"> <head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1"><title>Modern Multi-Screen Android Architecture Guide Using Java | Terminal Website</title><link rel="stylesheet" href="/_astro/about.OuLweBnF.css">
<link rel="stylesheet" href="/_astro/_slug_.DUFLA0uw.css"></head> <body> <div class="app-container"> <div class="content-area"> <nav> <div class="logo"> <a href="/">~/terminal@pnbe</a> </div> <div class="nav-links"> <a href="/" class> Home </a><a href="/blog" class="active"> Blog </a><a href="/projects" class> Projects </a><a href="/contact" class> Contact </a><a href="/about" class> About </a> </div> </nav> <main>  <article class="blog-post" data-astro-cid-4sn4zg3r> <div class="post-header" data-astro-cid-4sn4zg3r> <div class="post-meta" data-astro-cid-4sn4zg3r> <span class="post-date" data-astro-cid-4sn4zg3r>16/3/2025</span> <span class="post-id" data-astro-cid-4sn4zg3r>ID: b25250316</span> </div> <h1 class="post-title" data-astro-cid-4sn4zg3r>Modern Multi-Screen Android Architecture Guide Using Java</h1> <div class="post-tags" data-astro-cid-4sn4zg3r> <span class="post-tag" data-astro-cid-4sn4zg3r>#android</span><span class="post-tag" data-astro-cid-4sn4zg3r>#java</span><span class="post-tag" data-astro-cid-4sn4zg3r>#architecture</span><span class="post-tag" data-astro-cid-4sn4zg3r>#mvvm</span><span class="post-tag" data-astro-cid-4sn4zg3r>#clean-architecture</span><span class="post-tag" data-astro-cid-4sn4zg3r>#room</span><span class="post-tag" data-astro-cid-4sn4zg3r>#retrofit</span> </div> </div> <div class="terminal-block" data-astro-cid-4sn4zg3r> <div class="terminal-header" data-astro-cid-4sn4zg3r> <span data-astro-cid-4sn4zg3r>~/blog/android-architecture-guide</span> <div class="terminal-controls" data-astro-cid-4sn4zg3r> <span class="terminal-minimize" data-astro-cid-4sn4zg3r></span> <span class="terminal-maximize" data-astro-cid-4sn4zg3r></span> <span class="terminal-close" data-astro-cid-4sn4zg3r></span> </div> </div> <div class="blog-content" data-astro-cid-4sn4zg3r> <h1 id="modern-multi-screen-android-architecture-guide-using-java">Modern Multi-Screen Android Architecture Guide Using Java</h1>
<h2 id="introduction">Introduction</h2>
<p>This guide explores the architecture for building robust, maintainable, and testable multi-screen Android applications using Java, following modern architectural principles and design patterns. We’ll cover the complete architecture from UI components to data persistence, focusing on a modular, layered approach that separates concerns and creates a clean, scalable codebase.</p>
<h2 id="table-of-contents">Table of Contents</h2>
<ol>
<li><a href="#architectural-overview">Architectural Overview</a></li>
<li><a href="#application-layers">Application Layers</a></li>
<li><a href="#ui-layer">UI Layer</a>
<ul>
<li><a href="#activities">Activities</a></li>
<li><a href="#fragments">Fragments</a></li>
<li><a href="#navigation-component">Navigation Component</a></li>
</ul>
</li>
<li><a href="#presentation-layer">Presentation Layer</a>
<ul>
<li><a href="#viewmodel">ViewModel</a></li>
<li><a href="#livedata">LiveData</a></li>
<li><a href="#state-management">State Management</a></li>
</ul>
</li>
<li><a href="#domain-layer">Domain Layer</a>
<ul>
<li><a href="#use-cases--interactors">Use Cases / Interactors</a></li>
<li><a href="#domain-models">Domain Models</a></li>
</ul>
</li>
<li><a href="#data-layer">Data Layer</a>
<ul>
<li><a href="#repository-pattern">Repository Pattern</a></li>
<li><a href="#data-sources">Data Sources</a></li>
<li><a href="#room-database">Room Database</a></li>
<li><a href="#network-with-retrofit">Network with Retrofit</a></li>
</ul>
</li>
<li><a href="#dependency-injection">Dependency Injection</a></li>
<li><a href="#navigation-between-screens">Navigation Between Screens</a></li>
<li><a href="#error-handling">Error Handling</a></li>
<li><a href="#testing-strategy">Testing Strategy</a></li>
<li><a href="#complete-architecture-example">Complete Architecture Example</a></li>
<li><a href="#best-practices">Best Practices</a></li>
</ol>
<h2 id="architectural-overview">Architectural Overview</h2>
<p>A well-designed Android application follows these key principles:</p>
<ul>
<li><strong>Separation of concerns</strong>: Each component has specific responsibilities</li>
<li><strong>Driving UI from data models</strong>: UI reactively updates based on data changes</li>
<li><strong>Single source of truth</strong>: Data is stored and managed from one definitive source</li>
<li><strong>Unidirectional data flow</strong>: Data flows in one direction, making the app’s behavior predictable</li>
<li><strong>Testability</strong>: Architecture designed to make testing straightforward at all levels</li>
</ul>
<p>The recommended architecture follows the MVVM (Model-View-ViewModel) pattern enhanced with Clean Architecture principles:</p>
<p><img src="https://developer.android.com/topic/libraries/architecture/images/final-architecture.png" alt="Architecture Diagram"></p>
<h2 id="application-layers">Application Layers</h2>
<p>Our architecture consists of four main layers:</p>
<ol>
<li><strong>UI Layer</strong>: Activities, Fragments, Views, and UI-related components</li>
<li><strong>Presentation Layer</strong>: ViewModels and UI state management</li>
<li><strong>Domain Layer</strong>: Business logic and use cases</li>
<li><strong>Data Layer</strong>: Repositories and data sources (local/remote)</li>
</ol>
<p>Let’s explore each layer in detail.</p>
<h2 id="ui-layer">UI Layer</h2>
<p>The UI layer is responsible for displaying data to the user and capturing user interactions. It consists of Activities, Fragments, and custom Views.</p>
<h3 id="activities">Activities</h3>
<p>In a multi-screen application, Activities typically serve as containers for Fragments rather than containing UI logic themselves.</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="java"><code><span class="line"><span style="color:#F97583">public</span><span style="color:#F97583"> class</span><span style="color:#B392F0"> MainActivity</span><span style="color:#F97583"> extends</span><span style="color:#B392F0"> AppCompatActivity</span><span style="color:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#E1E4E8">    @</span><span style="color:#F97583">Override</span></span>
<span class="line"><span style="color:#F97583">    protected</span><span style="color:#F97583"> void</span><span style="color:#B392F0"> onCreate</span><span style="color:#E1E4E8">(Bundle </span><span style="color:#FFAB70">savedInstanceState</span><span style="color:#E1E4E8">) {</span></span>
<span class="line"><span style="color:#79B8FF">        super</span><span style="color:#E1E4E8">.</span><span style="color:#B392F0">onCreate</span><span style="color:#E1E4E8">(savedInstanceState);</span></span>
<span class="line"><span style="color:#B392F0">        setContentView</span><span style="color:#E1E4E8">(R.layout.activity_main);</span></span>
<span class="line"><span style="color:#E1E4E8">    }</span></span>
<span class="line"><span style="color:#E1E4E8">}</span></span></code></pre>
<h3 id="fragments">Fragments</h3>
<p>Fragments represent distinct screens or UI components within your app:</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="java"><code><span class="line"><span style="color:#F97583">public</span><span style="color:#F97583"> class</span><span style="color:#B392F0"> ProductListFragment</span><span style="color:#F97583"> extends</span><span style="color:#B392F0"> Fragment</span><span style="color:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#F97583">    private</span><span style="color:#E1E4E8"> ProductViewModel viewModel;</span></span>
<span class="line"><span style="color:#F97583">    private</span><span style="color:#E1E4E8"> ProductAdapter adapter;</span></span>
<span class="line"><span style="color:#E1E4E8">    </span></span>
<span class="line"><span style="color:#E1E4E8">    @</span><span style="color:#F97583">Override</span></span>
<span class="line"><span style="color:#F97583">    public</span><span style="color:#E1E4E8"> View </span><span style="color:#B392F0">onCreateView</span><span style="color:#E1E4E8">(@</span><span style="color:#F97583">NonNull</span><span style="color:#E1E4E8"> LayoutInflater </span><span style="color:#FFAB70">inflater</span><span style="color:#E1E4E8">, ViewGroup </span><span style="color:#FFAB70">container</span><span style="color:#E1E4E8">,</span></span>
<span class="line"><span style="color:#E1E4E8">                             Bundle </span><span style="color:#FFAB70">savedInstanceState</span><span style="color:#E1E4E8">) {</span></span>
<span class="line"><span style="color:#F97583">        return</span><span style="color:#E1E4E8"> inflater.</span><span style="color:#B392F0">inflate</span><span style="color:#E1E4E8">(R.layout.fragment_product_list, container, </span><span style="color:#79B8FF">false</span><span style="color:#E1E4E8">);</span></span>
<span class="line"><span style="color:#E1E4E8">    }</span></span>
<span class="line"><span style="color:#E1E4E8">    </span></span>
<span class="line"><span style="color:#E1E4E8">    @</span><span style="color:#F97583">Override</span></span>
<span class="line"><span style="color:#F97583">    public</span><span style="color:#F97583"> void</span><span style="color:#B392F0"> onViewCreated</span><span style="color:#E1E4E8">(@</span><span style="color:#F97583">NonNull</span><span style="color:#E1E4E8"> View </span><span style="color:#FFAB70">view</span><span style="color:#E1E4E8">, @</span><span style="color:#F97583">Nullable</span><span style="color:#E1E4E8"> Bundle </span><span style="color:#FFAB70">savedInstanceState</span><span style="color:#E1E4E8">) {</span></span>
<span class="line"><span style="color:#79B8FF">        super</span><span style="color:#E1E4E8">.</span><span style="color:#B392F0">onViewCreated</span><span style="color:#E1E4E8">(view, savedInstanceState);</span></span>
<span class="line"><span style="color:#E1E4E8">        </span></span>
<span class="line"><span style="color:#6A737D">        // Set up RecyclerView</span></span>
<span class="line"><span style="color:#E1E4E8">        RecyclerView recyclerView </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> view.</span><span style="color:#B392F0">findViewById</span><span style="color:#E1E4E8">(R.id.product_list);</span></span>
<span class="line"><span style="color:#E1E4E8">        adapter </span><span style="color:#F97583">=</span><span style="color:#F97583"> new</span><span style="color:#B392F0"> ProductAdapter</span><span style="color:#E1E4E8">(item </span><span style="color:#F97583">-></span><span style="color:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#6A737D">            // Navigate to product detail screen when item is clicked</span></span>
<span class="line"><span style="color:#B392F0">            navigateToProductDetail</span><span style="color:#E1E4E8">(item.</span><span style="color:#B392F0">getId</span><span style="color:#E1E4E8">());</span></span>
<span class="line"><span style="color:#E1E4E8">        });</span></span>
<span class="line"><span style="color:#E1E4E8">        recyclerView.</span><span style="color:#B392F0">setAdapter</span><span style="color:#E1E4E8">(adapter);</span></span>
<span class="line"><span style="color:#E1E4E8">        </span></span>
<span class="line"><span style="color:#6A737D">        // Initialize ViewModel</span></span>
<span class="line"><span style="color:#E1E4E8">        viewModel </span><span style="color:#F97583">=</span><span style="color:#F97583"> new</span><span style="color:#B392F0"> ViewModelProvider</span><span style="color:#E1E4E8">(</span><span style="color:#79B8FF">this</span><span style="color:#E1E4E8">).</span><span style="color:#B392F0">get</span><span style="color:#E1E4E8">(ProductViewModel.class);</span></span>
<span class="line"><span style="color:#E1E4E8">        </span></span>
<span class="line"><span style="color:#6A737D">        // Observe LiveData from ViewModel</span></span>
<span class="line"><span style="color:#E1E4E8">        viewModel.</span><span style="color:#B392F0">getProducts</span><span style="color:#E1E4E8">().</span><span style="color:#B392F0">observe</span><span style="color:#E1E4E8">(</span><span style="color:#B392F0">getViewLifecycleOwner</span><span style="color:#E1E4E8">(), products </span><span style="color:#F97583">-></span><span style="color:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#E1E4E8">            adapter.</span><span style="color:#B392F0">submitList</span><span style="color:#E1E4E8">(products);</span></span>
<span class="line"><span style="color:#E1E4E8">        });</span></span>
<span class="line"><span style="color:#E1E4E8">        </span></span>
<span class="line"><span style="color:#6A737D">        // Observe loading state</span></span>
<span class="line"><span style="color:#E1E4E8">        viewModel.</span><span style="color:#B392F0">getLoadingState</span><span style="color:#E1E4E8">().</span><span style="color:#B392F0">observe</span><span style="color:#E1E4E8">(</span><span style="color:#B392F0">getViewLifecycleOwner</span><span style="color:#E1E4E8">(), isLoading </span><span style="color:#F97583">-></span><span style="color:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#6A737D">            // Show/hide loading indicator</span></span>
<span class="line"><span style="color:#E1E4E8">            view.</span><span style="color:#B392F0">findViewById</span><span style="color:#E1E4E8">(R.id.progress_bar).</span><span style="color:#B392F0">setVisibility</span><span style="color:#E1E4E8">(</span></span>
<span class="line"><span style="color:#E1E4E8">                isLoading </span><span style="color:#F97583">?</span><span style="color:#E1E4E8"> View.VISIBLE </span><span style="color:#F97583">:</span><span style="color:#E1E4E8"> View.GONE);</span></span>
<span class="line"><span style="color:#E1E4E8">        });</span></span>
<span class="line"><span style="color:#E1E4E8">    }</span></span>
<span class="line"><span style="color:#E1E4E8">    </span></span>
<span class="line"><span style="color:#F97583">    private</span><span style="color:#F97583"> void</span><span style="color:#B392F0"> navigateToProductDetail</span><span style="color:#E1E4E8">(</span><span style="color:#F97583">long</span><span style="color:#FFAB70"> productId</span><span style="color:#E1E4E8">) {</span></span>
<span class="line"><span style="color:#E1E4E8">        Bundle args </span><span style="color:#F97583">=</span><span style="color:#F97583"> new</span><span style="color:#B392F0"> Bundle</span><span style="color:#E1E4E8">();</span></span>
<span class="line"><span style="color:#E1E4E8">        args.</span><span style="color:#B392F0">putLong</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">"productId"</span><span style="color:#E1E4E8">, productId);</span></span>
<span class="line"><span style="color:#E1E4E8">        </span></span>
<span class="line"><span style="color:#6A737D">        // Using Navigation Component</span></span>
<span class="line"><span style="color:#E1E4E8">        NavHostFragment.</span><span style="color:#B392F0">findNavController</span><span style="color:#E1E4E8">(</span><span style="color:#79B8FF">this</span><span style="color:#E1E4E8">)</span></span>
<span class="line"><span style="color:#E1E4E8">                .</span><span style="color:#B392F0">navigate</span><span style="color:#E1E4E8">(R.id.action_productList_to_productDetail, args);</span></span>
<span class="line"><span style="color:#E1E4E8">    }</span></span>
<span class="line"><span style="color:#E1E4E8">}</span></span></code></pre>
<h3 id="navigation-component">Navigation Component</h3>
<p>For multi-screen applications, the Navigation Component provides a framework for implementing navigation:</p>
<p><strong>nav_graph.xml</strong>:</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="xml"><code><span class="line"><span style="color:#E1E4E8">&#x3C;?</span><span style="color:#85E89D">xml</span><span style="color:#B392F0"> version</span><span style="color:#E1E4E8">=</span><span style="color:#9ECBFF">"1.0"</span><span style="color:#B392F0"> encoding</span><span style="color:#E1E4E8">=</span><span style="color:#9ECBFF">"utf-8"</span><span style="color:#E1E4E8">?></span></span>
<span class="line"><span style="color:#E1E4E8">&#x3C;</span><span style="color:#85E89D">navigation</span><span style="color:#B392F0"> xmlns:android</span><span style="color:#E1E4E8">=</span><span style="color:#9ECBFF">"http://schemas.android.com/apk/res/android"</span></span>
<span class="line"><span style="color:#B392F0">    xmlns:app</span><span style="color:#E1E4E8">=</span><span style="color:#9ECBFF">"http://schemas.android.com/apk/res-auto"</span></span>
<span class="line"><span style="color:#B392F0">    android:id</span><span style="color:#E1E4E8">=</span><span style="color:#9ECBFF">"@+id/nav_graph"</span></span>
<span class="line"><span style="color:#B392F0">    app:startDestination</span><span style="color:#E1E4E8">=</span><span style="color:#9ECBFF">"@id/productListFragment"</span><span style="color:#E1E4E8">></span></span>
<span class="line"><span style="color:#E1E4E8">    </span></span>
<span class="line"><span style="color:#E1E4E8">    &#x3C;</span><span style="color:#85E89D">fragment</span></span>
<span class="line"><span style="color:#B392F0">        android:id</span><span style="color:#E1E4E8">=</span><span style="color:#9ECBFF">"@+id/productListFragment"</span></span>
<span class="line"><span style="color:#B392F0">        android:name</span><span style="color:#E1E4E8">=</span><span style="color:#9ECBFF">"com.example.app.ui.ProductListFragment"</span></span>
<span class="line"><span style="color:#B392F0">        android:label</span><span style="color:#E1E4E8">=</span><span style="color:#9ECBFF">"Products"</span><span style="color:#E1E4E8">></span></span>
<span class="line"><span style="color:#E1E4E8">        &#x3C;</span><span style="color:#85E89D">action</span></span>
<span class="line"><span style="color:#B392F0">            android:id</span><span style="color:#E1E4E8">=</span><span style="color:#9ECBFF">"@+id/action_productList_to_productDetail"</span></span>
<span class="line"><span style="color:#B392F0">            app:destination</span><span style="color:#E1E4E8">=</span><span style="color:#9ECBFF">"@id/productDetailFragment"</span><span style="color:#E1E4E8"> /></span></span>
<span class="line"><span style="color:#E1E4E8">    &#x3C;/</span><span style="color:#85E89D">fragment</span><span style="color:#E1E4E8">></span></span>
<span class="line"><span style="color:#E1E4E8">    </span></span>
<span class="line"><span style="color:#E1E4E8">    &#x3C;</span><span style="color:#85E89D">fragment</span></span>
<span class="line"><span style="color:#B392F0">        android:id</span><span style="color:#E1E4E8">=</span><span style="color:#9ECBFF">"@+id/productDetailFragment"</span></span>
<span class="line"><span style="color:#B392F0">        android:name</span><span style="color:#E1E4E8">=</span><span style="color:#9ECBFF">"com.example.app.ui.ProductDetailFragment"</span></span>
<span class="line"><span style="color:#B392F0">        android:label</span><span style="color:#E1E4E8">=</span><span style="color:#9ECBFF">"Product Details"</span><span style="color:#E1E4E8">></span></span>
<span class="line"><span style="color:#E1E4E8">        &#x3C;</span><span style="color:#85E89D">argument</span></span>
<span class="line"><span style="color:#B392F0">            android:name</span><span style="color:#E1E4E8">=</span><span style="color:#9ECBFF">"productId"</span></span>
<span class="line"><span style="color:#B392F0">            app:argType</span><span style="color:#E1E4E8">=</span><span style="color:#9ECBFF">"long"</span><span style="color:#E1E4E8"> /></span></span>
<span class="line"><span style="color:#E1E4E8">    &#x3C;/</span><span style="color:#85E89D">fragment</span><span style="color:#E1E4E8">></span></span>
<span class="line"><span style="color:#E1E4E8">&#x3C;/</span><span style="color:#85E89D">navigation</span><span style="color:#E1E4E8">></span></span></code></pre>
<h2 id="presentation-layer">Presentation Layer</h2>
<p>The presentation layer contains ViewModels and UI state management logic.</p>
<h3 id="viewmodel">ViewModel</h3>
<p>ViewModels store and manage UI-related data, surviving configuration changes:</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="java"><code><span class="line"><span style="color:#F97583">public</span><span style="color:#F97583"> class</span><span style="color:#B392F0"> ProductViewModel</span><span style="color:#F97583"> extends</span><span style="color:#B392F0"> ViewModel</span><span style="color:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#F97583">    private</span><span style="color:#F97583"> final</span><span style="color:#E1E4E8"> ProductRepository repository;</span></span>
<span class="line"><span style="color:#F97583">    private</span><span style="color:#F97583"> final</span><span style="color:#E1E4E8"> MutableLiveData&#x3C;List&#x3C;</span><span style="color:#F97583">Product</span><span style="color:#E1E4E8">>> products </span><span style="color:#F97583">=</span><span style="color:#F97583"> new</span><span style="color:#E1E4E8"> MutableLiveData&#x3C;>();</span></span>
<span class="line"><span style="color:#F97583">    private</span><span style="color:#F97583"> final</span><span style="color:#E1E4E8"> MutableLiveData&#x3C;</span><span style="color:#F97583">Boolean</span><span style="color:#E1E4E8">> isLoading </span><span style="color:#F97583">=</span><span style="color:#F97583"> new</span><span style="color:#E1E4E8"> MutableLiveData&#x3C;>(</span><span style="color:#79B8FF">false</span><span style="color:#E1E4E8">);</span></span>
<span class="line"><span style="color:#E1E4E8">    </span></span>
<span class="line"><span style="color:#F97583">    public</span><span style="color:#B392F0"> ProductViewModel</span><span style="color:#E1E4E8">() {</span></span>
<span class="line"><span style="color:#6A737D">        // In real app, use dependency injection</span></span>
<span class="line"><span style="color:#E1E4E8">        repository </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> ProductRepository.</span><span style="color:#B392F0">getInstance</span><span style="color:#E1E4E8">();</span></span>
<span class="line"><span style="color:#B392F0">        loadProducts</span><span style="color:#E1E4E8">();</span></span>
<span class="line"><span style="color:#E1E4E8">    }</span></span>
<span class="line"><span style="color:#E1E4E8">    </span></span>
<span class="line"><span style="color:#F97583">    public</span><span style="color:#E1E4E8"> LiveData&#x3C;List&#x3C;</span><span style="color:#F97583">Product</span><span style="color:#E1E4E8">>> </span><span style="color:#B392F0">getProducts</span><span style="color:#E1E4E8">() {</span></span>
<span class="line"><span style="color:#F97583">        return</span><span style="color:#E1E4E8"> products;</span></span>
<span class="line"><span style="color:#E1E4E8">    }</span></span>
<span class="line"><span style="color:#E1E4E8">    </span></span>
<span class="line"><span style="color:#F97583">    public</span><span style="color:#E1E4E8"> LiveData&#x3C;</span><span style="color:#F97583">Boolean</span><span style="color:#E1E4E8">> </span><span style="color:#B392F0">getLoadingState</span><span style="color:#E1E4E8">() {</span></span>
<span class="line"><span style="color:#F97583">        return</span><span style="color:#E1E4E8"> isLoading;</span></span>
<span class="line"><span style="color:#E1E4E8">    }</span></span>
<span class="line"><span style="color:#E1E4E8">    </span></span>
<span class="line"><span style="color:#F97583">    private</span><span style="color:#F97583"> void</span><span style="color:#B392F0"> loadProducts</span><span style="color:#E1E4E8">() {</span></span>
<span class="line"><span style="color:#E1E4E8">        isLoading.</span><span style="color:#B392F0">setValue</span><span style="color:#E1E4E8">(</span><span style="color:#79B8FF">true</span><span style="color:#E1E4E8">);</span></span>
<span class="line"><span style="color:#E1E4E8">        </span></span>
<span class="line"><span style="color:#6A737D">        // Execute on a background thread</span></span>
<span class="line"><span style="color:#F97583">        new</span><span style="color:#B392F0"> Thread</span><span style="color:#E1E4E8">(() </span><span style="color:#F97583">-></span><span style="color:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#F97583">            try</span><span style="color:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#E1E4E8">                List&#x3C;</span><span style="color:#F97583">Product</span><span style="color:#E1E4E8">> result </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> repository.</span><span style="color:#B392F0">getProducts</span><span style="color:#E1E4E8">();</span></span>
<span class="line"><span style="color:#E1E4E8">                products.</span><span style="color:#B392F0">postValue</span><span style="color:#E1E4E8">(result);</span></span>
<span class="line"><span style="color:#E1E4E8">            } </span><span style="color:#F97583">catch</span><span style="color:#E1E4E8"> (Exception </span><span style="color:#FFAB70">e</span><span style="color:#E1E4E8">) {</span></span>
<span class="line"><span style="color:#6A737D">                // Handle error</span></span>
<span class="line"><span style="color:#E1E4E8">            } </span><span style="color:#F97583">finally</span><span style="color:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#E1E4E8">                isLoading.</span><span style="color:#B392F0">postValue</span><span style="color:#E1E4E8">(</span><span style="color:#79B8FF">false</span><span style="color:#E1E4E8">);</span></span>
<span class="line"><span style="color:#E1E4E8">            }</span></span>
<span class="line"><span style="color:#E1E4E8">        }).</span><span style="color:#B392F0">start</span><span style="color:#E1E4E8">();</span></span>
<span class="line"><span style="color:#E1E4E8">    }</span></span>
<span class="line"><span style="color:#E1E4E8">    </span></span>
<span class="line"><span style="color:#F97583">    public</span><span style="color:#F97583"> void</span><span style="color:#B392F0"> refreshProducts</span><span style="color:#E1E4E8">() {</span></span>
<span class="line"><span style="color:#B392F0">        loadProducts</span><span style="color:#E1E4E8">();</span></span>
<span class="line"><span style="color:#E1E4E8">    }</span></span>
<span class="line"><span style="color:#E1E4E8">}</span></span></code></pre>
<h3 id="livedata">LiveData</h3>
<p>LiveData is a lifecycle-aware observable data holder:</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="java"><code><span class="line"><span style="color:#6A737D">// In ViewModel</span></span>
<span class="line"><span style="color:#F97583">private</span><span style="color:#F97583"> final</span><span style="color:#E1E4E8"> MutableLiveData&#x3C;</span><span style="color:#F97583">User</span><span style="color:#E1E4E8">> userData </span><span style="color:#F97583">=</span><span style="color:#F97583"> new</span><span style="color:#E1E4E8"> MutableLiveData&#x3C;>();</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583">public</span><span style="color:#E1E4E8"> LiveData</span><span style="color:#F97583">&#x3C;</span><span style="color:#E1E4E8">User</span><span style="color:#F97583">></span><span style="color:#B392F0"> getUserData</span><span style="color:#E1E4E8">() {</span></span>
<span class="line"><span style="color:#F97583">    return</span><span style="color:#E1E4E8"> userData;</span></span>
<span class="line"><span style="color:#E1E4E8">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D">// In Fragment or Activity</span></span>
<span class="line"><span style="color:#E1E4E8">viewModel.</span><span style="color:#B392F0">getUserData</span><span style="color:#E1E4E8">().</span><span style="color:#B392F0">observe</span><span style="color:#E1E4E8">(</span><span style="color:#B392F0">getViewLifecycleOwner</span><span style="color:#E1E4E8">(), user </span><span style="color:#F97583">-></span><span style="color:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#6A737D">    // Update UI with user data</span></span>
<span class="line"><span style="color:#E1E4E8">});</span></span></code></pre>
<h3 id="state-management">State Management</h3>
<p>For more complex UIs, consider using a state object to represent the complete UI state:</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="java"><code><span class="line"><span style="color:#F97583">public</span><span style="color:#F97583"> class</span><span style="color:#B392F0"> ProductListState</span><span style="color:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#F97583">    private</span><span style="color:#F97583"> final</span><span style="color:#E1E4E8"> List&#x3C;</span><span style="color:#F97583">Product</span><span style="color:#E1E4E8">> products;</span></span>
<span class="line"><span style="color:#F97583">    private</span><span style="color:#F97583"> final</span><span style="color:#F97583"> boolean</span><span style="color:#E1E4E8"> isLoading;</span></span>
<span class="line"><span style="color:#F97583">    private</span><span style="color:#F97583"> final</span><span style="color:#E1E4E8"> String errorMessage;</span></span>
<span class="line"><span style="color:#E1E4E8">    </span></span>
<span class="line"><span style="color:#6A737D">    // Constructor, getters, etc.</span></span>
<span class="line"><span style="color:#E1E4E8">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D">// In ViewModel</span></span>
<span class="line"><span style="color:#F97583">private</span><span style="color:#F97583"> final</span><span style="color:#E1E4E8"> MutableLiveData&#x3C;</span><span style="color:#F97583">ProductListState</span><span style="color:#E1E4E8">> uiState </span><span style="color:#F97583">=</span><span style="color:#F97583"> new</span><span style="color:#E1E4E8"> MutableLiveData&#x3C;>();</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583">public</span><span style="color:#E1E4E8"> LiveData</span><span style="color:#F97583">&#x3C;</span><span style="color:#E1E4E8">ProductListState</span><span style="color:#F97583">></span><span style="color:#B392F0"> getUiState</span><span style="color:#E1E4E8">() {</span></span>
<span class="line"><span style="color:#F97583">    return</span><span style="color:#E1E4E8"> uiState;</span></span>
<span class="line"><span style="color:#E1E4E8">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D">// Update state</span></span>
<span class="line"><span style="color:#F97583">private</span><span style="color:#F97583"> void</span><span style="color:#B392F0"> updateState</span><span style="color:#E1E4E8">(List</span><span style="color:#F97583">&#x3C;</span><span style="color:#E1E4E8">Product</span><span style="color:#F97583">></span><span style="color:#E1E4E8"> newProducts, </span><span style="color:#F97583">boolean</span><span style="color:#E1E4E8"> loading, String error) {</span></span>
<span class="line"><span style="color:#E1E4E8">    ProductListState newState </span><span style="color:#F97583">=</span><span style="color:#F97583"> new</span><span style="color:#B392F0"> ProductListState</span><span style="color:#E1E4E8">(newProducts, loading, error);</span></span>
<span class="line"><span style="color:#E1E4E8">    uiState.</span><span style="color:#B392F0">setValue</span><span style="color:#E1E4E8">(newState);</span></span>
<span class="line"><span style="color:#E1E4E8">}</span></span></code></pre>
<h2 id="domain-layer">Domain Layer</h2>
<p>The domain layer contains business logic and use cases, independent of the Android framework.</p>
<h3 id="use-cases--interactors">Use Cases / Interactors</h3>
<p>Use cases encapsulate specific business operations:</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="java"><code><span class="line"><span style="color:#F97583">public</span><span style="color:#F97583"> class</span><span style="color:#B392F0"> GetProductsUseCase</span><span style="color:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#F97583">    private</span><span style="color:#F97583"> final</span><span style="color:#E1E4E8"> ProductRepository repository;</span></span>
<span class="line"><span style="color:#E1E4E8">    </span></span>
<span class="line"><span style="color:#F97583">    public</span><span style="color:#B392F0"> GetProductsUseCase</span><span style="color:#E1E4E8">(ProductRepository </span><span style="color:#FFAB70">repository</span><span style="color:#E1E4E8">) {</span></span>
<span class="line"><span style="color:#79B8FF">        this</span><span style="color:#E1E4E8">.repository </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> repository;</span></span>
<span class="line"><span style="color:#E1E4E8">    }</span></span>
<span class="line"><span style="color:#E1E4E8">    </span></span>
<span class="line"><span style="color:#F97583">    public</span><span style="color:#E1E4E8"> List&#x3C;</span><span style="color:#F97583">Product</span><span style="color:#E1E4E8">> </span><span style="color:#B392F0">execute</span><span style="color:#E1E4E8">() </span><span style="color:#F97583">throws</span><span style="color:#E1E4E8"> Exception {</span></span>
<span class="line"><span style="color:#F97583">        return</span><span style="color:#E1E4E8"> repository.</span><span style="color:#B392F0">getProducts</span><span style="color:#E1E4E8">();</span></span>
<span class="line"><span style="color:#E1E4E8">    }</span></span>
<span class="line"><span style="color:#E1E4E8">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583">public</span><span style="color:#F97583"> class</span><span style="color:#B392F0"> AddProductToCartUseCase</span><span style="color:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#F97583">    private</span><span style="color:#F97583"> final</span><span style="color:#E1E4E8"> CartRepository cartRepository;</span></span>
<span class="line"><span style="color:#F97583">    private</span><span style="color:#F97583"> final</span><span style="color:#E1E4E8"> ProductRepository productRepository;</span></span>
<span class="line"><span style="color:#E1E4E8">    </span></span>
<span class="line"><span style="color:#F97583">    public</span><span style="color:#B392F0"> AddProductToCartUseCase</span><span style="color:#E1E4E8">(CartRepository </span><span style="color:#FFAB70">cartRepository</span><span style="color:#E1E4E8">, </span></span>
<span class="line"><span style="color:#E1E4E8">                                  ProductRepository </span><span style="color:#FFAB70">productRepository</span><span style="color:#E1E4E8">) {</span></span>
<span class="line"><span style="color:#79B8FF">        this</span><span style="color:#E1E4E8">.cartRepository </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> cartRepository;</span></span>
<span class="line"><span style="color:#79B8FF">        this</span><span style="color:#E1E4E8">.productRepository </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> productRepository;</span></span>
<span class="line"><span style="color:#E1E4E8">    }</span></span>
<span class="line"><span style="color:#E1E4E8">    </span></span>
<span class="line"><span style="color:#F97583">    public</span><span style="color:#F97583"> void</span><span style="color:#B392F0"> execute</span><span style="color:#E1E4E8">(</span><span style="color:#F97583">long</span><span style="color:#FFAB70"> productId</span><span style="color:#E1E4E8">, </span><span style="color:#F97583">int</span><span style="color:#FFAB70"> quantity</span><span style="color:#E1E4E8">) </span><span style="color:#F97583">throws</span><span style="color:#E1E4E8"> Exception {</span></span>
<span class="line"><span style="color:#E1E4E8">        Product product </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> productRepository.</span><span style="color:#B392F0">getProductById</span><span style="color:#E1E4E8">(productId);</span></span>
<span class="line"><span style="color:#F97583">        if</span><span style="color:#E1E4E8"> (product </span><span style="color:#F97583">!=</span><span style="color:#79B8FF"> null</span><span style="color:#F97583"> &#x26;&#x26;</span><span style="color:#E1E4E8"> product.</span><span style="color:#B392F0">isInStock</span><span style="color:#E1E4E8">()) {</span></span>
<span class="line"><span style="color:#E1E4E8">            cartRepository.</span><span style="color:#B392F0">addItem</span><span style="color:#E1E4E8">(product, quantity);</span></span>
<span class="line"><span style="color:#E1E4E8">        } </span><span style="color:#F97583">else</span><span style="color:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#F97583">            throw</span><span style="color:#F97583"> new</span><span style="color:#B392F0"> OutOfStockException</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">"Product is out of stock"</span><span style="color:#E1E4E8">);</span></span>
<span class="line"><span style="color:#E1E4E8">        }</span></span>
<span class="line"><span style="color:#E1E4E8">    }</span></span>
<span class="line"><span style="color:#E1E4E8">}</span></span></code></pre>
<h3 id="domain-models">Domain Models</h3>
<p>Domain models represent core business entities:</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="java"><code><span class="line"><span style="color:#F97583">public</span><span style="color:#F97583"> class</span><span style="color:#B392F0"> Product</span><span style="color:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#F97583">    private</span><span style="color:#F97583"> final</span><span style="color:#F97583"> long</span><span style="color:#E1E4E8"> id;</span></span>
<span class="line"><span style="color:#F97583">    private</span><span style="color:#F97583"> final</span><span style="color:#E1E4E8"> String name;</span></span>
<span class="line"><span style="color:#F97583">    private</span><span style="color:#F97583"> final</span><span style="color:#E1E4E8"> String description;</span></span>
<span class="line"><span style="color:#F97583">    private</span><span style="color:#F97583"> final</span><span style="color:#F97583"> double</span><span style="color:#E1E4E8"> price;</span></span>
<span class="line"><span style="color:#F97583">    private</span><span style="color:#F97583"> final</span><span style="color:#F97583"> int</span><span style="color:#E1E4E8"> stockQuantity;</span></span>
<span class="line"><span style="color:#E1E4E8">    </span></span>
<span class="line"><span style="color:#6A737D">    // Constructor, getters, etc.</span></span>
<span class="line"><span style="color:#E1E4E8">    </span></span>
<span class="line"><span style="color:#F97583">    public</span><span style="color:#F97583"> boolean</span><span style="color:#B392F0"> isInStock</span><span style="color:#E1E4E8">() {</span></span>
<span class="line"><span style="color:#F97583">        return</span><span style="color:#E1E4E8"> stockQuantity </span><span style="color:#F97583">></span><span style="color:#79B8FF"> 0</span><span style="color:#E1E4E8">;</span></span>
<span class="line"><span style="color:#E1E4E8">    }</span></span>
<span class="line"><span style="color:#E1E4E8">}</span></span></code></pre>
<h2 id="data-layer">Data Layer</h2>
<p>The data layer handles data operations using the Repository pattern and various data sources.</p>
<h3 id="repository-pattern">Repository Pattern</h3>
<p>Repositories abstract the data sources and provide clean APIs to the rest of the app:</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="java"><code><span class="line"><span style="color:#F97583">public</span><span style="color:#F97583"> class</span><span style="color:#B392F0"> ProductRepository</span><span style="color:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#F97583">    private</span><span style="color:#F97583"> final</span><span style="color:#E1E4E8"> ProductRemoteDataSource remoteDataSource;</span></span>
<span class="line"><span style="color:#F97583">    private</span><span style="color:#F97583"> final</span><span style="color:#E1E4E8"> ProductLocalDataSource localDataSource;</span></span>
<span class="line"><span style="color:#E1E4E8">    </span></span>
<span class="line"><span style="color:#F97583">    public</span><span style="color:#B392F0"> ProductRepository</span><span style="color:#E1E4E8">(ProductRemoteDataSource </span><span style="color:#FFAB70">remoteDataSource</span><span style="color:#E1E4E8">,</span></span>
<span class="line"><span style="color:#E1E4E8">                            ProductLocalDataSource </span><span style="color:#FFAB70">localDataSource</span><span style="color:#E1E4E8">) {</span></span>
<span class="line"><span style="color:#79B8FF">        this</span><span style="color:#E1E4E8">.remoteDataSource </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> remoteDataSource;</span></span>
<span class="line"><span style="color:#79B8FF">        this</span><span style="color:#E1E4E8">.localDataSource </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> localDataSource;</span></span>
<span class="line"><span style="color:#E1E4E8">    }</span></span>
<span class="line"><span style="color:#E1E4E8">    </span></span>
<span class="line"><span style="color:#F97583">    public</span><span style="color:#E1E4E8"> List&#x3C;</span><span style="color:#F97583">Product</span><span style="color:#E1E4E8">> </span><span style="color:#B392F0">getProducts</span><span style="color:#E1E4E8">() </span><span style="color:#F97583">throws</span><span style="color:#E1E4E8"> Exception {</span></span>
<span class="line"><span style="color:#F97583">        try</span><span style="color:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#6A737D">            // Try to fetch fresh data from the network</span></span>
<span class="line"><span style="color:#E1E4E8">            List&#x3C;</span><span style="color:#F97583">ProductDto</span><span style="color:#E1E4E8">> networkResult </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> remoteDataSource.</span><span style="color:#B392F0">getProducts</span><span style="color:#E1E4E8">();</span></span>
<span class="line"><span style="color:#E1E4E8">            List&#x3C;</span><span style="color:#F97583">Product</span><span style="color:#E1E4E8">> products </span><span style="color:#F97583">=</span><span style="color:#B392F0"> mapToDomainModel</span><span style="color:#E1E4E8">(networkResult);</span></span>
<span class="line"><span style="color:#E1E4E8">            </span></span>
<span class="line"><span style="color:#6A737D">            // Cache the results locally</span></span>
<span class="line"><span style="color:#E1E4E8">            localDataSource.</span><span style="color:#B392F0">saveProducts</span><span style="color:#E1E4E8">(products);</span></span>
<span class="line"><span style="color:#E1E4E8">            </span></span>
<span class="line"><span style="color:#F97583">            return</span><span style="color:#E1E4E8"> products;</span></span>
<span class="line"><span style="color:#E1E4E8">        } </span><span style="color:#F97583">catch</span><span style="color:#E1E4E8"> (IOException </span><span style="color:#FFAB70">e</span><span style="color:#E1E4E8">) {</span></span>
<span class="line"><span style="color:#6A737D">            // Network error, try to fetch from local cache</span></span>
<span class="line"><span style="color:#F97583">            return</span><span style="color:#E1E4E8"> localDataSource.</span><span style="color:#B392F0">getProducts</span><span style="color:#E1E4E8">();</span></span>
<span class="line"><span style="color:#E1E4E8">        }</span></span>
<span class="line"><span style="color:#E1E4E8">    }</span></span>
<span class="line"><span style="color:#E1E4E8">    </span></span>
<span class="line"><span style="color:#F97583">    public</span><span style="color:#E1E4E8"> Product </span><span style="color:#B392F0">getProductById</span><span style="color:#E1E4E8">(</span><span style="color:#F97583">long</span><span style="color:#FFAB70"> id</span><span style="color:#E1E4E8">) </span><span style="color:#F97583">throws</span><span style="color:#E1E4E8"> Exception {</span></span>
<span class="line"><span style="color:#F97583">        try</span><span style="color:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#E1E4E8">            ProductDto dto </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> remoteDataSource.</span><span style="color:#B392F0">getProductById</span><span style="color:#E1E4E8">(id);</span></span>
<span class="line"><span style="color:#F97583">            return</span><span style="color:#B392F0"> mapToDomainModel</span><span style="color:#E1E4E8">(dto);</span></span>
<span class="line"><span style="color:#E1E4E8">        } </span><span style="color:#F97583">catch</span><span style="color:#E1E4E8"> (IOException </span><span style="color:#FFAB70">e</span><span style="color:#E1E4E8">) {</span></span>
<span class="line"><span style="color:#6A737D">            // Fallback to local cache</span></span>
<span class="line"><span style="color:#F97583">            return</span><span style="color:#E1E4E8"> localDataSource.</span><span style="color:#B392F0">getProductById</span><span style="color:#E1E4E8">(id);</span></span>
<span class="line"><span style="color:#E1E4E8">        }</span></span>
<span class="line"><span style="color:#E1E4E8">    }</span></span>
<span class="line"><span style="color:#E1E4E8">    </span></span>
<span class="line"><span style="color:#6A737D">    // Helper methods for mapping between DTOs and domain models</span></span>
<span class="line"><span style="color:#F97583">    private</span><span style="color:#E1E4E8"> List&#x3C;</span><span style="color:#F97583">Product</span><span style="color:#E1E4E8">> </span><span style="color:#B392F0">mapToDomainModel</span><span style="color:#E1E4E8">(List&#x3C;</span><span style="color:#F97583">ProductDto</span><span style="color:#E1E4E8">> </span><span style="color:#FFAB70">dtos</span><span style="color:#E1E4E8">) {</span></span>
<span class="line"><span style="color:#6A737D">        // Mapping logic</span></span>
<span class="line"><span style="color:#E1E4E8">    }</span></span>
<span class="line"><span style="color:#E1E4E8">    </span></span>
<span class="line"><span style="color:#F97583">    private</span><span style="color:#E1E4E8"> Product </span><span style="color:#B392F0">mapToDomainModel</span><span style="color:#E1E4E8">(ProductDto </span><span style="color:#FFAB70">dto</span><span style="color:#E1E4E8">) {</span></span>
<span class="line"><span style="color:#6A737D">        // Mapping logic</span></span>
<span class="line"><span style="color:#E1E4E8">    }</span></span>
<span class="line"><span style="color:#E1E4E8">}</span></span></code></pre>
<h3 id="data-sources">Data Sources</h3>
<p>Data sources handle specific data operations:</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="java"><code><span class="line"><span style="color:#F97583">public</span><span style="color:#F97583"> interface</span><span style="color:#B392F0"> ProductDataSource</span><span style="color:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#E1E4E8">    List&#x3C;</span><span style="color:#F97583">ProductDto</span><span style="color:#E1E4E8">> </span><span style="color:#B392F0">getProducts</span><span style="color:#E1E4E8">() </span><span style="color:#F97583">throws</span><span style="color:#E1E4E8"> Exception;</span></span>
<span class="line"><span style="color:#E1E4E8">    ProductDto </span><span style="color:#B392F0">getProductById</span><span style="color:#E1E4E8">(</span><span style="color:#F97583">long</span><span style="color:#FFAB70"> id</span><span style="color:#E1E4E8">) </span><span style="color:#F97583">throws</span><span style="color:#E1E4E8"> Exception;</span></span>
<span class="line"><span style="color:#E1E4E8">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583">public</span><span style="color:#F97583"> class</span><span style="color:#B392F0"> ProductRemoteDataSource</span><span style="color:#F97583"> implements</span><span style="color:#B392F0"> ProductDataSource</span><span style="color:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#F97583">    private</span><span style="color:#F97583"> final</span><span style="color:#E1E4E8"> ProductApiService apiService;</span></span>
<span class="line"><span style="color:#E1E4E8">    </span></span>
<span class="line"><span style="color:#F97583">    public</span><span style="color:#B392F0"> ProductRemoteDataSource</span><span style="color:#E1E4E8">(ProductApiService </span><span style="color:#FFAB70">apiService</span><span style="color:#E1E4E8">) {</span></span>
<span class="line"><span style="color:#79B8FF">        this</span><span style="color:#E1E4E8">.apiService </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> apiService;</span></span>
<span class="line"><span style="color:#E1E4E8">    }</span></span>
<span class="line"><span style="color:#E1E4E8">    </span></span>
<span class="line"><span style="color:#E1E4E8">    @</span><span style="color:#F97583">Override</span></span>
<span class="line"><span style="color:#F97583">    public</span><span style="color:#E1E4E8"> List&#x3C;</span><span style="color:#F97583">ProductDto</span><span style="color:#E1E4E8">> </span><span style="color:#B392F0">getProducts</span><span style="color:#E1E4E8">() </span><span style="color:#F97583">throws</span><span style="color:#E1E4E8"> IOException {</span></span>
<span class="line"><span style="color:#E1E4E8">        Response&#x3C;List&#x3C;</span><span style="color:#F97583">ProductDto</span><span style="color:#E1E4E8">>> response </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> apiService.</span><span style="color:#B392F0">getProducts</span><span style="color:#E1E4E8">().</span><span style="color:#B392F0">execute</span><span style="color:#E1E4E8">();</span></span>
<span class="line"><span style="color:#F97583">        if</span><span style="color:#E1E4E8"> (response.</span><span style="color:#B392F0">isSuccessful</span><span style="color:#E1E4E8">()) {</span></span>
<span class="line"><span style="color:#F97583">            return</span><span style="color:#E1E4E8"> response.</span><span style="color:#B392F0">body</span><span style="color:#E1E4E8">();</span></span>
<span class="line"><span style="color:#E1E4E8">        } </span><span style="color:#F97583">else</span><span style="color:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#F97583">            throw</span><span style="color:#F97583"> new</span><span style="color:#B392F0"> IOException</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">"Error fetching products: "</span><span style="color:#F97583"> +</span><span style="color:#E1E4E8"> response.</span><span style="color:#B392F0">errorBody</span><span style="color:#E1E4E8">());</span></span>
<span class="line"><span style="color:#E1E4E8">        }</span></span>
<span class="line"><span style="color:#E1E4E8">    }</span></span>
<span class="line"><span style="color:#E1E4E8">    </span></span>
<span class="line"><span style="color:#E1E4E8">    @</span><span style="color:#F97583">Override</span></span>
<span class="line"><span style="color:#F97583">    public</span><span style="color:#E1E4E8"> ProductDto </span><span style="color:#B392F0">getProductById</span><span style="color:#E1E4E8">(</span><span style="color:#F97583">long</span><span style="color:#FFAB70"> id</span><span style="color:#E1E4E8">) </span><span style="color:#F97583">throws</span><span style="color:#E1E4E8"> IOException {</span></span>
<span class="line"><span style="color:#E1E4E8">        Response&#x3C;</span><span style="color:#F97583">ProductDto</span><span style="color:#E1E4E8">> response </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> apiService.</span><span style="color:#B392F0">getProductById</span><span style="color:#E1E4E8">(id).</span><span style="color:#B392F0">execute</span><span style="color:#E1E4E8">();</span></span>
<span class="line"><span style="color:#F97583">        if</span><span style="color:#E1E4E8"> (response.</span><span style="color:#B392F0">isSuccessful</span><span style="color:#E1E4E8">()) {</span></span>
<span class="line"><span style="color:#F97583">            return</span><span style="color:#E1E4E8"> response.</span><span style="color:#B392F0">body</span><span style="color:#E1E4E8">();</span></span>
<span class="line"><span style="color:#E1E4E8">        } </span><span style="color:#F97583">else</span><span style="color:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#F97583">            throw</span><span style="color:#F97583"> new</span><span style="color:#B392F0"> IOException</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">"Error fetching product: "</span><span style="color:#F97583"> +</span><span style="color:#E1E4E8"> response.</span><span style="color:#B392F0">errorBody</span><span style="color:#E1E4E8">());</span></span>
<span class="line"><span style="color:#E1E4E8">        }</span></span>
<span class="line"><span style="color:#E1E4E8">    }</span></span>
<span class="line"><span style="color:#E1E4E8">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583">public</span><span style="color:#F97583"> class</span><span style="color:#B392F0"> ProductLocalDataSource</span><span style="color:#F97583"> implements</span><span style="color:#B392F0"> ProductDataSource</span><span style="color:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#F97583">    private</span><span style="color:#F97583"> final</span><span style="color:#E1E4E8"> ProductDao productDao;</span></span>
<span class="line"><span style="color:#E1E4E8">    </span></span>
<span class="line"><span style="color:#F97583">    public</span><span style="color:#B392F0"> ProductLocalDataSource</span><span style="color:#E1E4E8">(ProductDao </span><span style="color:#FFAB70">productDao</span><span style="color:#E1E4E8">) {</span></span>
<span class="line"><span style="color:#79B8FF">        this</span><span style="color:#E1E4E8">.productDao </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> productDao;</span></span>
<span class="line"><span style="color:#E1E4E8">    }</span></span>
<span class="line"><span style="color:#E1E4E8">    </span></span>
<span class="line"><span style="color:#E1E4E8">    @</span><span style="color:#F97583">Override</span></span>
<span class="line"><span style="color:#F97583">    public</span><span style="color:#E1E4E8"> List&#x3C;</span><span style="color:#F97583">ProductDto</span><span style="color:#E1E4E8">> </span><span style="color:#B392F0">getProducts</span><span style="color:#E1E4E8">() {</span></span>
<span class="line"><span style="color:#E1E4E8">        List&#x3C;</span><span style="color:#F97583">ProductEntity</span><span style="color:#E1E4E8">> entities </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> productDao.</span><span style="color:#B392F0">getAll</span><span style="color:#E1E4E8">();</span></span>
<span class="line"><span style="color:#F97583">        return</span><span style="color:#B392F0"> mapToDataModel</span><span style="color:#E1E4E8">(entities);</span></span>
<span class="line"><span style="color:#E1E4E8">    }</span></span>
<span class="line"><span style="color:#E1E4E8">    </span></span>
<span class="line"><span style="color:#E1E4E8">    @</span><span style="color:#F97583">Override</span></span>
<span class="line"><span style="color:#F97583">    public</span><span style="color:#E1E4E8"> ProductDto </span><span style="color:#B392F0">getProductById</span><span style="color:#E1E4E8">(</span><span style="color:#F97583">long</span><span style="color:#FFAB70"> id</span><span style="color:#E1E4E8">) {</span></span>
<span class="line"><span style="color:#E1E4E8">        ProductEntity entity </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> productDao.</span><span style="color:#B392F0">getById</span><span style="color:#E1E4E8">(id);</span></span>
<span class="line"><span style="color:#F97583">        return</span><span style="color:#B392F0"> mapToDataModel</span><span style="color:#E1E4E8">(entity);</span></span>
<span class="line"><span style="color:#E1E4E8">    }</span></span>
<span class="line"><span style="color:#E1E4E8">    </span></span>
<span class="line"><span style="color:#F97583">    public</span><span style="color:#F97583"> void</span><span style="color:#B392F0"> saveProducts</span><span style="color:#E1E4E8">(List&#x3C;</span><span style="color:#F97583">Product</span><span style="color:#E1E4E8">> </span><span style="color:#FFAB70">products</span><span style="color:#E1E4E8">) {</span></span>
<span class="line"><span style="color:#E1E4E8">        List&#x3C;</span><span style="color:#F97583">ProductEntity</span><span style="color:#E1E4E8">> entities </span><span style="color:#F97583">=</span><span style="color:#B392F0"> mapToEntityModel</span><span style="color:#E1E4E8">(products);</span></span>
<span class="line"><span style="color:#E1E4E8">        productDao.</span><span style="color:#B392F0">insertAll</span><span style="color:#E1E4E8">(entities);</span></span>
<span class="line"><span style="color:#E1E4E8">    }</span></span>
<span class="line"><span style="color:#E1E4E8">    </span></span>
<span class="line"><span style="color:#6A737D">    // Mapping methods</span></span>
<span class="line"><span style="color:#F97583">    private</span><span style="color:#E1E4E8"> List&#x3C;</span><span style="color:#F97583">ProductDto</span><span style="color:#E1E4E8">> </span><span style="color:#B392F0">mapToDataModel</span><span style="color:#E1E4E8">(List&#x3C;</span><span style="color:#F97583">ProductEntity</span><span style="color:#E1E4E8">> </span><span style="color:#FFAB70">entities</span><span style="color:#E1E4E8">) {</span></span>
<span class="line"><span style="color:#6A737D">        // Mapping logic</span></span>
<span class="line"><span style="color:#E1E4E8">    }</span></span>
<span class="line"><span style="color:#E1E4E8">    </span></span>
<span class="line"><span style="color:#F97583">    private</span><span style="color:#E1E4E8"> ProductDto </span><span style="color:#B392F0">mapToDataModel</span><span style="color:#E1E4E8">(ProductEntity </span><span style="color:#FFAB70">entity</span><span style="color:#E1E4E8">) {</span></span>
<span class="line"><span style="color:#6A737D">        // Mapping logic</span></span>
<span class="line"><span style="color:#E1E4E8">    }</span></span>
<span class="line"><span style="color:#E1E4E8">    </span></span>
<span class="line"><span style="color:#F97583">    private</span><span style="color:#E1E4E8"> List&#x3C;</span><span style="color:#F97583">ProductEntity</span><span style="color:#E1E4E8">> </span><span style="color:#B392F0">mapToEntityModel</span><span style="color:#E1E4E8">(List&#x3C;</span><span style="color:#F97583">Product</span><span style="color:#E1E4E8">> </span><span style="color:#FFAB70">products</span><span style="color:#E1E4E8">) {</span></span>
<span class="line"><span style="color:#6A737D">        // Mapping logic</span></span>
<span class="line"><span style="color:#E1E4E8">    }</span></span>
<span class="line"><span style="color:#E1E4E8">}</span></span></code></pre>
<h3 id="room-database">Room Database</h3>
<p>Room provides an abstraction layer over SQLite for local data persistence:</p>
<p><strong>ProductEntity.java</strong>:</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="java"><code><span class="line"><span style="color:#E1E4E8">@</span><span style="color:#F97583">Entity</span><span style="color:#E1E4E8">(</span><span style="color:#79B8FF">tableName</span><span style="color:#F97583"> =</span><span style="color:#9ECBFF"> "products"</span><span style="color:#E1E4E8">)</span></span>
<span class="line"><span style="color:#F97583">public</span><span style="color:#F97583"> class</span><span style="color:#B392F0"> ProductEntity</span><span style="color:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#E1E4E8">    @</span><span style="color:#F97583">PrimaryKey</span></span>
<span class="line"><span style="color:#F97583">    private</span><span style="color:#F97583"> long</span><span style="color:#E1E4E8"> id;</span></span>
<span class="line"><span style="color:#F97583">    private</span><span style="color:#E1E4E8"> String name;</span></span>
<span class="line"><span style="color:#F97583">    private</span><span style="color:#E1E4E8"> String description;</span></span>
<span class="line"><span style="color:#F97583">    private</span><span style="color:#F97583"> double</span><span style="color:#E1E4E8"> price;</span></span>
<span class="line"><span style="color:#F97583">    private</span><span style="color:#F97583"> int</span><span style="color:#E1E4E8"> stockQuantity;</span></span>
<span class="line"><span style="color:#E1E4E8">    </span></span>
<span class="line"><span style="color:#6A737D">    // Constructor, getters, setters</span></span>
<span class="line"><span style="color:#E1E4E8">}</span></span></code></pre>
<p><strong>ProductDao.java</strong>:</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="java"><code><span class="line"><span style="color:#E1E4E8">@</span><span style="color:#F97583">Dao</span></span>
<span class="line"><span style="color:#F97583">public</span><span style="color:#F97583"> interface</span><span style="color:#B392F0"> ProductDao</span><span style="color:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#E1E4E8">    @</span><span style="color:#F97583">Query</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">"SELECT * FROM products"</span><span style="color:#E1E4E8">)</span></span>
<span class="line"><span style="color:#E1E4E8">    List&#x3C;</span><span style="color:#F97583">ProductEntity</span><span style="color:#E1E4E8">> </span><span style="color:#B392F0">getAll</span><span style="color:#E1E4E8">();</span></span>
<span class="line"><span style="color:#E1E4E8">    </span></span>
<span class="line"><span style="color:#E1E4E8">    @</span><span style="color:#F97583">Query</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">"SELECT * FROM products WHERE id = :id"</span><span style="color:#E1E4E8">)</span></span>
<span class="line"><span style="color:#E1E4E8">    ProductEntity </span><span style="color:#B392F0">getById</span><span style="color:#E1E4E8">(</span><span style="color:#F97583">long</span><span style="color:#FFAB70"> id</span><span style="color:#E1E4E8">);</span></span>
<span class="line"><span style="color:#E1E4E8">    </span></span>
<span class="line"><span style="color:#E1E4E8">    @</span><span style="color:#F97583">Insert</span><span style="color:#E1E4E8">(</span><span style="color:#79B8FF">onConflict</span><span style="color:#F97583"> =</span><span style="color:#E1E4E8"> OnConflictStrategy.REPLACE)</span></span>
<span class="line"><span style="color:#F97583">    void</span><span style="color:#B392F0"> insertAll</span><span style="color:#E1E4E8">(List&#x3C;</span><span style="color:#F97583">ProductEntity</span><span style="color:#E1E4E8">> </span><span style="color:#FFAB70">products</span><span style="color:#E1E4E8">);</span></span>
<span class="line"><span style="color:#E1E4E8">    </span></span>
<span class="line"><span style="color:#E1E4E8">    @</span><span style="color:#F97583">Update</span></span>
<span class="line"><span style="color:#F97583">    void</span><span style="color:#B392F0"> update</span><span style="color:#E1E4E8">(ProductEntity </span><span style="color:#FFAB70">product</span><span style="color:#E1E4E8">);</span></span>
<span class="line"><span style="color:#E1E4E8">    </span></span>
<span class="line"><span style="color:#E1E4E8">    @</span><span style="color:#F97583">Delete</span></span>
<span class="line"><span style="color:#F97583">    void</span><span style="color:#B392F0"> delete</span><span style="color:#E1E4E8">(ProductEntity </span><span style="color:#FFAB70">product</span><span style="color:#E1E4E8">);</span></span>
<span class="line"><span style="color:#E1E4E8">}</span></span></code></pre>
<p><strong>AppDatabase.java</strong>:</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="java"><code><span class="line"><span style="color:#E1E4E8">@</span><span style="color:#F97583">Database</span><span style="color:#E1E4E8">(</span><span style="color:#79B8FF">entities</span><span style="color:#F97583"> =</span><span style="color:#E1E4E8"> {ProductEntity.class, UserEntity.class}, </span><span style="color:#79B8FF">version</span><span style="color:#F97583"> =</span><span style="color:#79B8FF"> 1</span><span style="color:#E1E4E8">)</span></span>
<span class="line"><span style="color:#F97583">public</span><span style="color:#F97583"> abstract</span><span style="color:#F97583"> class</span><span style="color:#B392F0"> AppDatabase</span><span style="color:#F97583"> extends</span><span style="color:#B392F0"> RoomDatabase</span><span style="color:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#F97583">    public</span><span style="color:#F97583"> abstract</span><span style="color:#E1E4E8"> ProductDao </span><span style="color:#B392F0">productDao</span><span style="color:#E1E4E8">();</span></span>
<span class="line"><span style="color:#F97583">    public</span><span style="color:#F97583"> abstract</span><span style="color:#E1E4E8"> UserDao </span><span style="color:#B392F0">userDao</span><span style="color:#E1E4E8">();</span></span>
<span class="line"><span style="color:#E1E4E8">    </span></span>
<span class="line"><span style="color:#F97583">    private</span><span style="color:#F97583"> static</span><span style="color:#F97583"> volatile</span><span style="color:#E1E4E8"> AppDatabase INSTANCE;</span></span>
<span class="line"><span style="color:#E1E4E8">    </span></span>
<span class="line"><span style="color:#F97583">    public</span><span style="color:#F97583"> static</span><span style="color:#E1E4E8"> AppDatabase </span><span style="color:#B392F0">getInstance</span><span style="color:#E1E4E8">(Context </span><span style="color:#FFAB70">context</span><span style="color:#E1E4E8">) {</span></span>
<span class="line"><span style="color:#F97583">        if</span><span style="color:#E1E4E8"> (INSTANCE </span><span style="color:#F97583">==</span><span style="color:#79B8FF"> null</span><span style="color:#E1E4E8">) {</span></span>
<span class="line"><span style="color:#F97583">            synchronized</span><span style="color:#E1E4E8"> (AppDatabase.class) {</span></span>
<span class="line"><span style="color:#F97583">                if</span><span style="color:#E1E4E8"> (INSTANCE </span><span style="color:#F97583">==</span><span style="color:#79B8FF"> null</span><span style="color:#E1E4E8">) {</span></span>
<span class="line"><span style="color:#E1E4E8">                    INSTANCE </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> Room.</span><span style="color:#B392F0">databaseBuilder</span><span style="color:#E1E4E8">(</span></span>
<span class="line"><span style="color:#E1E4E8">                            context.</span><span style="color:#B392F0">getApplicationContext</span><span style="color:#E1E4E8">(),</span></span>
<span class="line"><span style="color:#E1E4E8">                            AppDatabase.class,</span></span>
<span class="line"><span style="color:#9ECBFF">                            "app_database"</span><span style="color:#E1E4E8">)</span></span>
<span class="line"><span style="color:#E1E4E8">                            .</span><span style="color:#B392F0">build</span><span style="color:#E1E4E8">();</span></span>
<span class="line"><span style="color:#E1E4E8">                }</span></span>
<span class="line"><span style="color:#E1E4E8">            }</span></span>
<span class="line"><span style="color:#E1E4E8">        }</span></span>
<span class="line"><span style="color:#F97583">        return</span><span style="color:#E1E4E8"> INSTANCE;</span></span>
<span class="line"><span style="color:#E1E4E8">    }</span></span>
<span class="line"><span style="color:#E1E4E8">}</span></span></code></pre>
<h3 id="network-with-retrofit">Network with Retrofit</h3>
<p>Retrofit is used for making API calls:</p>
<p><strong>ProductApiService.java</strong>:</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="java"><code><span class="line"><span style="color:#F97583">public</span><span style="color:#F97583"> interface</span><span style="color:#B392F0"> ProductApiService</span><span style="color:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#E1E4E8">    @</span><span style="color:#F97583">GET</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">"products"</span><span style="color:#E1E4E8">)</span></span>
<span class="line"><span style="color:#E1E4E8">    Call&#x3C;List&#x3C;</span><span style="color:#F97583">ProductDto</span><span style="color:#E1E4E8">>> </span><span style="color:#B392F0">getProducts</span><span style="color:#E1E4E8">();</span></span>
<span class="line"><span style="color:#E1E4E8">    </span></span>
<span class="line"><span style="color:#E1E4E8">    @</span><span style="color:#F97583">GET</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">"products/{id}"</span><span style="color:#E1E4E8">)</span></span>
<span class="line"><span style="color:#E1E4E8">    Call&#x3C;</span><span style="color:#F97583">ProductDto</span><span style="color:#E1E4E8">> </span><span style="color:#B392F0">getProductById</span><span style="color:#E1E4E8">(@</span><span style="color:#F97583">Path</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">"id"</span><span style="color:#E1E4E8">) </span><span style="color:#F97583">long</span><span style="color:#FFAB70"> id</span><span style="color:#E1E4E8">);</span></span>
<span class="line"><span style="color:#E1E4E8">    </span></span>
<span class="line"><span style="color:#E1E4E8">    @</span><span style="color:#F97583">POST</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">"products"</span><span style="color:#E1E4E8">)</span></span>
<span class="line"><span style="color:#E1E4E8">    Call&#x3C;</span><span style="color:#F97583">ProductDto</span><span style="color:#E1E4E8">> </span><span style="color:#B392F0">createProduct</span><span style="color:#E1E4E8">(@</span><span style="color:#F97583">Body</span><span style="color:#E1E4E8"> ProductDto </span><span style="color:#FFAB70">product</span><span style="color:#E1E4E8">);</span></span>
<span class="line"><span style="color:#E1E4E8">}</span></span></code></pre>
<p><strong>ProductDto.java</strong>:</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="java"><code><span class="line"><span style="color:#F97583">public</span><span style="color:#F97583"> class</span><span style="color:#B392F0"> ProductDto</span><span style="color:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#E1E4E8">    @</span><span style="color:#F97583">SerializedName</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">"id"</span><span style="color:#E1E4E8">)</span></span>
<span class="line"><span style="color:#F97583">    private</span><span style="color:#F97583"> long</span><span style="color:#E1E4E8"> id;</span></span>
<span class="line"><span style="color:#E1E4E8">    </span></span>
<span class="line"><span style="color:#E1E4E8">    @</span><span style="color:#F97583">SerializedName</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">"name"</span><span style="color:#E1E4E8">)</span></span>
<span class="line"><span style="color:#F97583">    private</span><span style="color:#E1E4E8"> String name;</span></span>
<span class="line"><span style="color:#E1E4E8">    </span></span>
<span class="line"><span style="color:#E1E4E8">    @</span><span style="color:#F97583">SerializedName</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">"description"</span><span style="color:#E1E4E8">)</span></span>
<span class="line"><span style="color:#F97583">    private</span><span style="color:#E1E4E8"> String description;</span></span>
<span class="line"><span style="color:#E1E4E8">    </span></span>
<span class="line"><span style="color:#E1E4E8">    @</span><span style="color:#F97583">SerializedName</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">"price"</span><span style="color:#E1E4E8">)</span></span>
<span class="line"><span style="color:#F97583">    private</span><span style="color:#F97583"> double</span><span style="color:#E1E4E8"> price;</span></span>
<span class="line"><span style="color:#E1E4E8">    </span></span>
<span class="line"><span style="color:#E1E4E8">    @</span><span style="color:#F97583">SerializedName</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">"in_stock"</span><span style="color:#E1E4E8">)</span></span>
<span class="line"><span style="color:#F97583">    private</span><span style="color:#F97583"> boolean</span><span style="color:#E1E4E8"> inStock;</span></span>
<span class="line"><span style="color:#E1E4E8">    </span></span>
<span class="line"><span style="color:#6A737D">    // Constructor, getters, setters</span></span>
<span class="line"><span style="color:#E1E4E8">}</span></span></code></pre>
<p><strong>RetrofitClient.java</strong>:</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="java"><code><span class="line"><span style="color:#F97583">public</span><span style="color:#F97583"> class</span><span style="color:#B392F0"> RetrofitClient</span><span style="color:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#F97583">    private</span><span style="color:#F97583"> static</span><span style="color:#F97583"> final</span><span style="color:#E1E4E8"> String BASE_URL </span><span style="color:#F97583">=</span><span style="color:#9ECBFF"> "https://api.example.com/"</span><span style="color:#E1E4E8">;</span></span>
<span class="line"><span style="color:#F97583">    private</span><span style="color:#F97583"> static</span><span style="color:#E1E4E8"> Retrofit retrofit </span><span style="color:#F97583">=</span><span style="color:#79B8FF"> null</span><span style="color:#E1E4E8">;</span></span>
<span class="line"><span style="color:#E1E4E8">    </span></span>
<span class="line"><span style="color:#F97583">    public</span><span style="color:#F97583"> static</span><span style="color:#E1E4E8"> Retrofit </span><span style="color:#B392F0">getClient</span><span style="color:#E1E4E8">() {</span></span>
<span class="line"><span style="color:#F97583">        if</span><span style="color:#E1E4E8"> (retrofit </span><span style="color:#F97583">==</span><span style="color:#79B8FF"> null</span><span style="color:#E1E4E8">) {</span></span>
<span class="line"><span style="color:#E1E4E8">            OkHttpClient client </span><span style="color:#F97583">=</span><span style="color:#F97583"> new</span><span style="color:#E1E4E8"> OkHttpClient.</span><span style="color:#B392F0">Builder</span><span style="color:#E1E4E8">()</span></span>
<span class="line"><span style="color:#E1E4E8">                    .</span><span style="color:#B392F0">connectTimeout</span><span style="color:#E1E4E8">(</span><span style="color:#79B8FF">60</span><span style="color:#E1E4E8">, TimeUnit.SECONDS)</span></span>
<span class="line"><span style="color:#E1E4E8">                    .</span><span style="color:#B392F0">readTimeout</span><span style="color:#E1E4E8">(</span><span style="color:#79B8FF">60</span><span style="color:#E1E4E8">, TimeUnit.SECONDS)</span></span>
<span class="line"><span style="color:#E1E4E8">                    .</span><span style="color:#B392F0">addInterceptor</span><span style="color:#E1E4E8">(</span><span style="color:#F97583">new</span><span style="color:#B392F0"> HttpLoggingInterceptor</span><span style="color:#E1E4E8">().</span><span style="color:#B392F0">setLevel</span><span style="color:#E1E4E8">(HttpLoggingInterceptor.Level.BODY))</span></span>
<span class="line"><span style="color:#E1E4E8">                    .</span><span style="color:#B392F0">build</span><span style="color:#E1E4E8">();</span></span>
<span class="line"><span style="color:#E1E4E8">            </span></span>
<span class="line"><span style="color:#E1E4E8">            retrofit </span><span style="color:#F97583">=</span><span style="color:#F97583"> new</span><span style="color:#E1E4E8"> Retrofit.</span><span style="color:#B392F0">Builder</span><span style="color:#E1E4E8">()</span></span>
<span class="line"><span style="color:#E1E4E8">                    .</span><span style="color:#B392F0">baseUrl</span><span style="color:#E1E4E8">(BASE_URL)</span></span>
<span class="line"><span style="color:#E1E4E8">                    .</span><span style="color:#B392F0">client</span><span style="color:#E1E4E8">(client)</span></span>
<span class="line"><span style="color:#E1E4E8">                    .</span><span style="color:#B392F0">addConverterFactory</span><span style="color:#E1E4E8">(GsonConverterFactory.</span><span style="color:#B392F0">create</span><span style="color:#E1E4E8">())</span></span>
<span class="line"><span style="color:#E1E4E8">                    .</span><span style="color:#B392F0">build</span><span style="color:#E1E4E8">();</span></span>
<span class="line"><span style="color:#E1E4E8">        }</span></span>
<span class="line"><span style="color:#F97583">        return</span><span style="color:#E1E4E8"> retrofit;</span></span>
<span class="line"><span style="color:#E1E4E8">    }</span></span>
<span class="line"><span style="color:#E1E4E8">}</span></span></code></pre>
<h2 id="dependency-injection">Dependency Injection</h2>
<p>For a production application, use a dependency injection framework like Dagger or Hilt to manage dependencies. For a simpler approach, you can create factory classes:</p>
<p><strong>ViewModelFactory.java</strong>:</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="java"><code><span class="line"><span style="color:#F97583">public</span><span style="color:#F97583"> class</span><span style="color:#B392F0"> ViewModelFactory</span><span style="color:#F97583"> implements</span><span style="color:#B392F0"> ViewModelProvider.Factory</span><span style="color:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#F97583">    private</span><span style="color:#F97583"> final</span><span style="color:#E1E4E8"> ProductRepository productRepository;</span></span>
<span class="line"><span style="color:#E1E4E8">    </span></span>
<span class="line"><span style="color:#F97583">    public</span><span style="color:#B392F0"> ViewModelFactory</span><span style="color:#E1E4E8">(ProductRepository </span><span style="color:#FFAB70">productRepository</span><span style="color:#E1E4E8">) {</span></span>
<span class="line"><span style="color:#79B8FF">        this</span><span style="color:#E1E4E8">.productRepository </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> productRepository;</span></span>
<span class="line"><span style="color:#E1E4E8">    }</span></span>
<span class="line"><span style="color:#E1E4E8">    </span></span>
<span class="line"><span style="color:#E1E4E8">    @</span><span style="color:#F97583">NonNull</span></span>
<span class="line"><span style="color:#E1E4E8">    @</span><span style="color:#F97583">Override</span></span>
<span class="line"><span style="color:#F97583">    public</span><span style="color:#E1E4E8"> &#x3C;</span><span style="color:#F97583">T</span><span style="color:#F97583"> extends</span><span style="color:#F97583"> ViewModel</span><span style="color:#E1E4E8">> T </span><span style="color:#B392F0">create</span><span style="color:#E1E4E8">(@</span><span style="color:#F97583">NonNull</span><span style="color:#E1E4E8"> Class&#x3C;</span><span style="color:#F97583">T</span><span style="color:#E1E4E8">> </span><span style="color:#FFAB70">modelClass</span><span style="color:#E1E4E8">) {</span></span>
<span class="line"><span style="color:#F97583">        if</span><span style="color:#E1E4E8"> (modelClass.</span><span style="color:#B392F0">isAssignableFrom</span><span style="color:#E1E4E8">(ProductViewModel.class)) {</span></span>
<span class="line"><span style="color:#F97583">            return</span><span style="color:#E1E4E8"> (T) </span><span style="color:#F97583">new</span><span style="color:#B392F0"> ProductViewModel</span><span style="color:#E1E4E8">(productRepository);</span></span>
<span class="line"><span style="color:#E1E4E8">        }</span></span>
<span class="line"><span style="color:#F97583">        throw</span><span style="color:#F97583"> new</span><span style="color:#B392F0"> IllegalArgumentException</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">"Unknown ViewModel class"</span><span style="color:#E1E4E8">);</span></span>
<span class="line"><span style="color:#E1E4E8">    }</span></span>
<span class="line"><span style="color:#E1E4E8">}</span></span></code></pre>
<h2 id="navigation-between-screens">Navigation Between Screens</h2>
<p>For a multi-screen application, the Navigation Component is recommended:</p>
<p><strong>Setup in Activity</strong>:</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="java"><code><span class="line"><span style="color:#F97583">public</span><span style="color:#F97583"> class</span><span style="color:#B392F0"> MainActivity</span><span style="color:#F97583"> extends</span><span style="color:#B392F0"> AppCompatActivity</span><span style="color:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#E1E4E8">    @</span><span style="color:#F97583">Override</span></span>
<span class="line"><span style="color:#F97583">    protected</span><span style="color:#F97583"> void</span><span style="color:#B392F0"> onCreate</span><span style="color:#E1E4E8">(Bundle </span><span style="color:#FFAB70">savedInstanceState</span><span style="color:#E1E4E8">) {</span></span>
<span class="line"><span style="color:#79B8FF">        super</span><span style="color:#E1E4E8">.</span><span style="color:#B392F0">onCreate</span><span style="color:#E1E4E8">(savedInstanceState);</span></span>
<span class="line"><span style="color:#B392F0">        setContentView</span><span style="color:#E1E4E8">(R.layout.activity_main);</span></span>
<span class="line"><span style="color:#E1E4E8">        </span></span>
<span class="line"><span style="color:#E1E4E8">        NavHostFragment navHostFragment </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> (NavHostFragment) </span><span style="color:#B392F0">getSupportFragmentManager</span><span style="color:#E1E4E8">()</span></span>
<span class="line"><span style="color:#E1E4E8">                .</span><span style="color:#B392F0">findFragmentById</span><span style="color:#E1E4E8">(R.id.nav_host_fragment);</span></span>
<span class="line"><span style="color:#E1E4E8">        NavController navController </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> navHostFragment.</span><span style="color:#B392F0">getNavController</span><span style="color:#E1E4E8">();</span></span>
<span class="line"><span style="color:#E1E4E8">        </span></span>
<span class="line"><span style="color:#6A737D">        // Set up ActionBar with NavController</span></span>
<span class="line"><span style="color:#E1E4E8">        AppBarConfiguration appBarConfiguration </span><span style="color:#F97583">=</span><span style="color:#F97583"> new</span><span style="color:#E1E4E8"> AppBarConfiguration</span></span>
<span class="line"><span style="color:#E1E4E8">                .</span><span style="color:#B392F0">Builder</span><span style="color:#E1E4E8">(navController.</span><span style="color:#B392F0">getGraph</span><span style="color:#E1E4E8">())</span></span>
<span class="line"><span style="color:#E1E4E8">                .</span><span style="color:#B392F0">build</span><span style="color:#E1E4E8">();</span></span>
<span class="line"><span style="color:#E1E4E8">        NavigationUI.</span><span style="color:#B392F0">setupActionBarWithNavController</span><span style="color:#E1E4E8">(</span><span style="color:#79B8FF">this</span><span style="color:#E1E4E8">, navController, appBarConfiguration);</span></span>
<span class="line"><span style="color:#E1E4E8">    }</span></span>
<span class="line"><span style="color:#E1E4E8">    </span></span>
<span class="line"><span style="color:#E1E4E8">    @</span><span style="color:#F97583">Override</span></span>
<span class="line"><span style="color:#F97583">    public</span><span style="color:#F97583"> boolean</span><span style="color:#B392F0"> onSupportNavigateUp</span><span style="color:#E1E4E8">() {</span></span>
<span class="line"><span style="color:#E1E4E8">        NavController navController </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> Navigation.</span><span style="color:#B392F0">findNavController</span><span style="color:#E1E4E8">(</span></span>
<span class="line"><span style="color:#79B8FF">                this</span><span style="color:#E1E4E8">, R.id.nav_host_fragment);</span></span>
<span class="line"><span style="color:#F97583">        return</span><span style="color:#E1E4E8"> navController.</span><span style="color:#B392F0">navigateUp</span><span style="color:#E1E4E8">() </span><span style="color:#F97583">||</span><span style="color:#79B8FF"> super</span><span style="color:#E1E4E8">.</span><span style="color:#B392F0">onSupportNavigateUp</span><span style="color:#E1E4E8">();</span></span>
<span class="line"><span style="color:#E1E4E8">    }</span></span>
<span class="line"><span style="color:#E1E4E8">}</span></span></code></pre>
<p><strong>Navigating Between Fragments</strong>:</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="java"><code><span class="line"><span style="color:#6A737D">// Navigate with arguments</span></span>
<span class="line"><span style="color:#E1E4E8">Bundle args </span><span style="color:#F97583">=</span><span style="color:#F97583"> new</span><span style="color:#B392F0"> Bundle</span><span style="color:#E1E4E8">();</span></span>
<span class="line"><span style="color:#E1E4E8">args.</span><span style="color:#B392F0">putLong</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">"productId"</span><span style="color:#E1E4E8">, product.</span><span style="color:#B392F0">getId</span><span style="color:#E1E4E8">());</span></span>
<span class="line"><span style="color:#E1E4E8">NavHostFragment.</span><span style="color:#B392F0">findNavController</span><span style="color:#E1E4E8">(</span><span style="color:#79B8FF">this</span><span style="color:#E1E4E8">)</span></span>
<span class="line"><span style="color:#E1E4E8">        .</span><span style="color:#B392F0">navigate</span><span style="color:#E1E4E8">(R.id.action_productList_to_productDetail, args);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D">// Simple navigation</span></span>
<span class="line"><span style="color:#E1E4E8">NavHostFragment.</span><span style="color:#B392F0">findNavController</span><span style="color:#E1E4E8">(</span><span style="color:#79B8FF">this</span><span style="color:#E1E4E8">)</span></span>
<span class="line"><span style="color:#E1E4E8">        .</span><span style="color:#B392F0">navigate</span><span style="color:#E1E4E8">(R.id.action_productDetail_to_cart);</span></span></code></pre>
<h2 id="error-handling">Error Handling</h2>
<p>Implement a comprehensive error handling strategy:</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="java"><code><span class="line"><span style="color:#F97583">public</span><span style="color:#F97583"> class</span><span style="color:#B392F0"> Result</span><span style="color:#E1E4E8">&#x3C;</span><span style="color:#F97583">T</span><span style="color:#E1E4E8">> {</span></span>
<span class="line"><span style="color:#F97583">    private</span><span style="color:#F97583"> final</span><span style="color:#E1E4E8"> T data;</span></span>
<span class="line"><span style="color:#F97583">    private</span><span style="color:#F97583"> final</span><span style="color:#E1E4E8"> Exception error;</span></span>
<span class="line"><span style="color:#E1E4E8">    </span></span>
<span class="line"><span style="color:#F97583">    private</span><span style="color:#B392F0"> Result</span><span style="color:#E1E4E8">(T </span><span style="color:#FFAB70">data</span><span style="color:#E1E4E8">, Exception </span><span style="color:#FFAB70">error</span><span style="color:#E1E4E8">) {</span></span>
<span class="line"><span style="color:#79B8FF">        this</span><span style="color:#E1E4E8">.data </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> data;</span></span>
<span class="line"><span style="color:#79B8FF">        this</span><span style="color:#E1E4E8">.error </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> error;</span></span>
<span class="line"><span style="color:#E1E4E8">    }</span></span>
<span class="line"><span style="color:#E1E4E8">    </span></span>
<span class="line"><span style="color:#F97583">    public</span><span style="color:#F97583"> static</span><span style="color:#E1E4E8"> &#x3C;</span><span style="color:#F97583">T</span><span style="color:#E1E4E8">> Result&#x3C;</span><span style="color:#F97583">T</span><span style="color:#E1E4E8">> </span><span style="color:#B392F0">success</span><span style="color:#E1E4E8">(T </span><span style="color:#FFAB70">data</span><span style="color:#E1E4E8">) {</span></span>
<span class="line"><span style="color:#F97583">        return</span><span style="color:#F97583"> new</span><span style="color:#E1E4E8"> Result&#x3C;>(data, </span><span style="color:#79B8FF">null</span><span style="color:#E1E4E8">);</span></span>
<span class="line"><span style="color:#E1E4E8">    }</span></span>
<span class="line"><span style="color:#E1E4E8">    </span></span>
<span class="line"><span style="color:#F97583">    public</span><span style="color:#F97583"> static</span><span style="color:#E1E4E8"> &#x3C;</span><span style="color:#F97583">T</span><span style="color:#E1E4E8">> Result&#x3C;</span><span style="color:#F97583">T</span><span style="color:#E1E4E8">> </span><span style="color:#B392F0">error</span><span style="color:#E1E4E8">(Exception </span><span style="color:#FFAB70">error</span><span style="color:#E1E4E8">) {</span></span>
<span class="line"><span style="color:#F97583">        return</span><span style="color:#F97583"> new</span><span style="color:#E1E4E8"> Result&#x3C;>(</span><span style="color:#79B8FF">null</span><span style="color:#E1E4E8">, error);</span></span>
<span class="line"><span style="color:#E1E4E8">    }</span></span>
<span class="line"><span style="color:#E1E4E8">    </span></span>
<span class="line"><span style="color:#F97583">    public</span><span style="color:#F97583"> boolean</span><span style="color:#B392F0"> isSuccess</span><span style="color:#E1E4E8">() {</span></span>
<span class="line"><span style="color:#F97583">        return</span><span style="color:#E1E4E8"> error </span><span style="color:#F97583">==</span><span style="color:#79B8FF"> null</span><span style="color:#E1E4E8">;</span></span>
<span class="line"><span style="color:#E1E4E8">    }</span></span>
<span class="line"><span style="color:#E1E4E8">    </span></span>
<span class="line"><span style="color:#F97583">    public</span><span style="color:#E1E4E8"> T </span><span style="color:#B392F0">getData</span><span style="color:#E1E4E8">() {</span></span>
<span class="line"><span style="color:#F97583">        return</span><span style="color:#E1E4E8"> data;</span></span>
<span class="line"><span style="color:#E1E4E8">    }</span></span>
<span class="line"><span style="color:#E1E4E8">    </span></span>
<span class="line"><span style="color:#F97583">    public</span><span style="color:#E1E4E8"> Exception </span><span style="color:#B392F0">getError</span><span style="color:#E1E4E8">() {</span></span>
<span class="line"><span style="color:#F97583">        return</span><span style="color:#E1E4E8"> error;</span></span>
<span class="line"><span style="color:#E1E4E8">    }</span></span>
<span class="line"><span style="color:#E1E4E8">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D">// In Repository</span></span>
<span class="line"><span style="color:#F97583">public</span><span style="color:#E1E4E8"> Result</span><span style="color:#F97583">&#x3C;</span><span style="color:#E1E4E8">List</span><span style="color:#F97583">&#x3C;</span><span style="color:#E1E4E8">Product</span><span style="color:#F97583">>></span><span style="color:#B392F0"> getProductsWithResult</span><span style="color:#E1E4E8">() {</span></span>
<span class="line"><span style="color:#F97583">    try</span><span style="color:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#E1E4E8">        List&#x3C;</span><span style="color:#F97583">Product</span><span style="color:#E1E4E8">> products </span><span style="color:#F97583">=</span><span style="color:#B392F0"> getProducts</span><span style="color:#E1E4E8">();</span></span>
<span class="line"><span style="color:#F97583">        return</span><span style="color:#E1E4E8"> Result.</span><span style="color:#B392F0">success</span><span style="color:#E1E4E8">(products);</span></span>
<span class="line"><span style="color:#E1E4E8">    } </span><span style="color:#F97583">catch</span><span style="color:#E1E4E8"> (Exception </span><span style="color:#FFAB70">e</span><span style="color:#E1E4E8">) {</span></span>
<span class="line"><span style="color:#F97583">        return</span><span style="color:#E1E4E8"> Result.</span><span style="color:#B392F0">error</span><span style="color:#E1E4E8">(e);</span></span>
<span class="line"><span style="color:#E1E4E8">    }</span></span>
<span class="line"><span style="color:#E1E4E8">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D">// In ViewModel</span></span>
<span class="line"><span style="color:#F97583">public</span><span style="color:#F97583"> void</span><span style="color:#B392F0"> loadProductsWithErrorHandling</span><span style="color:#E1E4E8">() {</span></span>
<span class="line"><span style="color:#E1E4E8">    isLoading.</span><span style="color:#B392F0">setValue</span><span style="color:#E1E4E8">(</span><span style="color:#79B8FF">true</span><span style="color:#E1E4E8">);</span></span>
<span class="line"><span style="color:#E1E4E8">    </span></span>
<span class="line"><span style="color:#F97583">    new</span><span style="color:#B392F0"> Thread</span><span style="color:#E1E4E8">(() </span><span style="color:#F97583">-></span><span style="color:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#E1E4E8">        Result&#x3C;List&#x3C;</span><span style="color:#F97583">Product</span><span style="color:#E1E4E8">>> result </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> repository.</span><span style="color:#B392F0">getProductsWithResult</span><span style="color:#E1E4E8">();</span></span>
<span class="line"><span style="color:#F97583">        if</span><span style="color:#E1E4E8"> (result.</span><span style="color:#B392F0">isSuccess</span><span style="color:#E1E4E8">()) {</span></span>
<span class="line"><span style="color:#E1E4E8">            products.</span><span style="color:#B392F0">postValue</span><span style="color:#E1E4E8">(result.</span><span style="color:#B392F0">getData</span><span style="color:#E1E4E8">());</span></span>
<span class="line"><span style="color:#E1E4E8">            error.</span><span style="color:#B392F0">postValue</span><span style="color:#E1E4E8">(</span><span style="color:#79B8FF">null</span><span style="color:#E1E4E8">);</span></span>
<span class="line"><span style="color:#E1E4E8">        } </span><span style="color:#F97583">else</span><span style="color:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#E1E4E8">            error.</span><span style="color:#B392F0">postValue</span><span style="color:#E1E4E8">(result.</span><span style="color:#B392F0">getError</span><span style="color:#E1E4E8">().</span><span style="color:#B392F0">getMessage</span><span style="color:#E1E4E8">());</span></span>
<span class="line"><span style="color:#E1E4E8">        }</span></span>
<span class="line"><span style="color:#E1E4E8">        isLoading.</span><span style="color:#B392F0">postValue</span><span style="color:#E1E4E8">(</span><span style="color:#79B8FF">false</span><span style="color:#E1E4E8">);</span></span>
<span class="line"><span style="color:#E1E4E8">    }).</span><span style="color:#B392F0">start</span><span style="color:#E1E4E8">();</span></span>
<span class="line"><span style="color:#E1E4E8">}</span></span></code></pre>
<h2 id="testing-strategy">Testing Strategy</h2>
<p>A good architecture makes testing easier:</p>
<p><strong>Unit Testing ViewModels</strong>:</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="java"><code><span class="line"><span style="color:#E1E4E8">@</span><span style="color:#F97583">RunWith</span><span style="color:#E1E4E8">(JUnit4.class)</span></span>
<span class="line"><span style="color:#F97583">public</span><span style="color:#F97583"> class</span><span style="color:#B392F0"> ProductViewModelTest</span><span style="color:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#6A737D">    // Test rule for LiveData</span></span>
<span class="line"><span style="color:#E1E4E8">    @</span><span style="color:#F97583">Rule</span></span>
<span class="line"><span style="color:#F97583">    public</span><span style="color:#E1E4E8"> InstantTaskExecutorRule instantTaskExecutorRule </span><span style="color:#F97583">=</span><span style="color:#F97583"> new</span><span style="color:#B392F0"> InstantTaskExecutorRule</span><span style="color:#E1E4E8">();</span></span>
<span class="line"><span style="color:#E1E4E8">    </span></span>
<span class="line"><span style="color:#F97583">    private</span><span style="color:#E1E4E8"> ProductRepository mockRepository;</span></span>
<span class="line"><span style="color:#F97583">    private</span><span style="color:#E1E4E8"> ProductViewModel viewModel;</span></span>
<span class="line"><span style="color:#E1E4E8">    </span></span>
<span class="line"><span style="color:#E1E4E8">    @</span><span style="color:#F97583">Before</span></span>
<span class="line"><span style="color:#F97583">    public</span><span style="color:#F97583"> void</span><span style="color:#B392F0"> setup</span><span style="color:#E1E4E8">() {</span></span>
<span class="line"><span style="color:#E1E4E8">        mockRepository </span><span style="color:#F97583">=</span><span style="color:#B392F0"> mock</span><span style="color:#E1E4E8">(ProductRepository.class);</span></span>
<span class="line"><span style="color:#E1E4E8">        viewModel </span><span style="color:#F97583">=</span><span style="color:#F97583"> new</span><span style="color:#B392F0"> ProductViewModel</span><span style="color:#E1E4E8">(mockRepository);</span></span>
<span class="line"><span style="color:#E1E4E8">    }</span></span>
<span class="line"><span style="color:#E1E4E8">    </span></span>
<span class="line"><span style="color:#E1E4E8">    @</span><span style="color:#F97583">Test</span></span>
<span class="line"><span style="color:#F97583">    public</span><span style="color:#F97583"> void</span><span style="color:#B392F0"> loadProducts_success</span><span style="color:#E1E4E8">() </span><span style="color:#F97583">throws</span><span style="color:#E1E4E8"> Exception {</span></span>
<span class="line"><span style="color:#6A737D">        // Arrange</span></span>
<span class="line"><span style="color:#E1E4E8">        List&#x3C;</span><span style="color:#F97583">Product</span><span style="color:#E1E4E8">> expectedProducts </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> Arrays.</span><span style="color:#B392F0">asList</span><span style="color:#E1E4E8">(</span></span>
<span class="line"><span style="color:#F97583">                new</span><span style="color:#B392F0"> Product</span><span style="color:#E1E4E8">(</span><span style="color:#79B8FF">1</span><span style="color:#E1E4E8">, </span><span style="color:#9ECBFF">"Product 1"</span><span style="color:#E1E4E8">, </span><span style="color:#9ECBFF">"Description 1"</span><span style="color:#E1E4E8">, </span><span style="color:#79B8FF">10.0</span><span style="color:#E1E4E8">, </span><span style="color:#79B8FF">5</span><span style="color:#E1E4E8">),</span></span>
<span class="line"><span style="color:#F97583">                new</span><span style="color:#B392F0"> Product</span><span style="color:#E1E4E8">(</span><span style="color:#79B8FF">2</span><span style="color:#E1E4E8">, </span><span style="color:#9ECBFF">"Product 2"</span><span style="color:#E1E4E8">, </span><span style="color:#9ECBFF">"Description 2"</span><span style="color:#E1E4E8">, </span><span style="color:#79B8FF">20.0</span><span style="color:#E1E4E8">, </span><span style="color:#79B8FF">10</span><span style="color:#E1E4E8">)</span></span>
<span class="line"><span style="color:#E1E4E8">        );</span></span>
<span class="line"><span style="color:#B392F0">        when</span><span style="color:#E1E4E8">(mockRepository.</span><span style="color:#B392F0">getProducts</span><span style="color:#E1E4E8">()).</span><span style="color:#B392F0">thenReturn</span><span style="color:#E1E4E8">(expectedProducts);</span></span>
<span class="line"><span style="color:#E1E4E8">        </span></span>
<span class="line"><span style="color:#6A737D">        // Act</span></span>
<span class="line"><span style="color:#E1E4E8">        viewModel.</span><span style="color:#B392F0">loadProducts</span><span style="color:#E1E4E8">();</span></span>
<span class="line"><span style="color:#E1E4E8">        </span></span>
<span class="line"><span style="color:#6A737D">        // Assert</span></span>
<span class="line"><span style="color:#B392F0">        verify</span><span style="color:#E1E4E8">(mockRepository).</span><span style="color:#B392F0">getProducts</span><span style="color:#E1E4E8">();</span></span>
<span class="line"><span style="color:#B392F0">        assertEquals</span><span style="color:#E1E4E8">(expectedProducts, viewModel.</span><span style="color:#B392F0">getProducts</span><span style="color:#E1E4E8">().</span><span style="color:#B392F0">getValue</span><span style="color:#E1E4E8">());</span></span>
<span class="line"><span style="color:#B392F0">        assertEquals</span><span style="color:#E1E4E8">(</span><span style="color:#79B8FF">false</span><span style="color:#E1E4E8">, viewModel.</span><span style="color:#B392F0">getLoadingState</span><span style="color:#E1E4E8">().</span><span style="color:#B392F0">getValue</span><span style="color:#E1E4E8">());</span></span>
<span class="line"><span style="color:#E1E4E8">    }</span></span>
<span class="line"><span style="color:#E1E4E8">    </span></span>
<span class="line"><span style="color:#E1E4E8">    @</span><span style="color:#F97583">Test</span></span>
<span class="line"><span style="color:#F97583">    public</span><span style="color:#F97583"> void</span><span style="color:#B392F0"> loadProducts_error</span><span style="color:#E1E4E8">() </span><span style="color:#F97583">throws</span><span style="color:#E1E4E8"> Exception {</span></span>
<span class="line"><span style="color:#6A737D">        // Arrange</span></span>
<span class="line"><span style="color:#E1E4E8">        Exception expectedException </span><span style="color:#F97583">=</span><span style="color:#F97583"> new</span><span style="color:#B392F0"> IOException</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">"Network error"</span><span style="color:#E1E4E8">);</span></span>
<span class="line"><span style="color:#B392F0">        when</span><span style="color:#E1E4E8">(mockRepository.</span><span style="color:#B392F0">getProducts</span><span style="color:#E1E4E8">()).</span><span style="color:#B392F0">thenThrow</span><span style="color:#E1E4E8">(expectedException);</span></span>
<span class="line"><span style="color:#E1E4E8">        </span></span>
<span class="line"><span style="color:#6A737D">        // Act</span></span>
<span class="line"><span style="color:#E1E4E8">        viewModel.</span><span style="color:#B392F0">loadProducts</span><span style="color:#E1E4E8">();</span></span>
<span class="line"><span style="color:#E1E4E8">        </span></span>
<span class="line"><span style="color:#6A737D">        // Assert</span></span>
<span class="line"><span style="color:#B392F0">        verify</span><span style="color:#E1E4E8">(mockRepository).</span><span style="color:#B392F0">getProducts</span><span style="color:#E1E4E8">();</span></span>
<span class="line"><span style="color:#B392F0">        assertEquals</span><span style="color:#E1E4E8">(expectedException.</span><span style="color:#B392F0">getMessage</span><span style="color:#E1E4E8">(), viewModel.</span><span style="color:#B392F0">getError</span><span style="color:#E1E4E8">().</span><span style="color:#B392F0">getValue</span><span style="color:#E1E4E8">());</span></span>
<span class="line"><span style="color:#B392F0">        assertEquals</span><span style="color:#E1E4E8">(</span><span style="color:#79B8FF">false</span><span style="color:#E1E4E8">, viewModel.</span><span style="color:#B392F0">getLoadingState</span><span style="color:#E1E4E8">().</span><span style="color:#B392F0">getValue</span><span style="color:#E1E4E8">());</span></span>
<span class="line"><span style="color:#E1E4E8">    }</span></span>
<span class="line"><span style="color:#E1E4E8">}</span></span></code></pre>
<p><strong>Testing Repositories</strong>:</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="java"><code><span class="line"><span style="color:#E1E4E8">@</span><span style="color:#F97583">RunWith</span><span style="color:#E1E4E8">(JUnit4.class)</span></span>
<span class="line"><span style="color:#F97583">public</span><span style="color:#F97583"> class</span><span style="color:#B392F0"> ProductRepositoryTest</span><span style="color:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#F97583">    private</span><span style="color:#E1E4E8"> ProductRemoteDataSource mockRemoteDataSource;</span></span>
<span class="line"><span style="color:#F97583">    private</span><span style="color:#E1E4E8"> ProductLocalDataSource mockLocalDataSource;</span></span>
<span class="line"><span style="color:#F97583">    private</span><span style="color:#E1E4E8"> ProductRepository repository;</span></span>
<span class="line"><span style="color:#E1E4E8">    </span></span>
<span class="line"><span style="color:#E1E4E8">    @</span><span style="color:#F97583">Before</span></span>
<span class="line"><span style="color:#F97583">    public</span><span style="color:#F97583"> void</span><span style="color:#B392F0"> setup</span><span style="color:#E1E4E8">() {</span></span>
<span class="line"><span style="color:#E1E4E8">        mockRemoteDataSource </span><span style="color:#F97583">=</span><span style="color:#B392F0"> mock</span><span style="color:#E1E4E8">(ProductRemoteDataSource.class);</span></span>
<span class="line"><span style="color:#E1E4E8">        mockLocalDataSource </span><span style="color:#F97583">=</span><span style="color:#B392F0"> mock</span><span style="color:#E1E4E8">(ProductLocalDataSource.class);</span></span>
<span class="line"><span style="color:#E1E4E8">        repository </span><span style="color:#F97583">=</span><span style="color:#F97583"> new</span><span style="color:#B392F0"> ProductRepository</span><span style="color:#E1E4E8">(mockRemoteDataSource, mockLocalDataSource);</span></span>
<span class="line"><span style="color:#E1E4E8">    }</span></span>
<span class="line"><span style="color:#E1E4E8">    </span></span>
<span class="line"><span style="color:#E1E4E8">    @</span><span style="color:#F97583">Test</span></span>
<span class="line"><span style="color:#F97583">    public</span><span style="color:#F97583"> void</span><span style="color:#B392F0"> getProducts_remoteSuccess</span><span style="color:#E1E4E8">() </span><span style="color:#F97583">throws</span><span style="color:#E1E4E8"> Exception {</span></span>
<span class="line"><span style="color:#6A737D">        // Arrange</span></span>
<span class="line"><span style="color:#E1E4E8">        List&#x3C;</span><span style="color:#F97583">ProductDto</span><span style="color:#E1E4E8">> remoteDtos </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> Arrays.</span><span style="color:#B392F0">asList</span><span style="color:#E1E4E8">(</span></span>
<span class="line"><span style="color:#F97583">                new</span><span style="color:#B392F0"> ProductDto</span><span style="color:#E1E4E8">(</span><span style="color:#79B8FF">1</span><span style="color:#E1E4E8">, </span><span style="color:#9ECBFF">"Product 1"</span><span style="color:#E1E4E8">, </span><span style="color:#9ECBFF">"Description 1"</span><span style="color:#E1E4E8">, </span><span style="color:#79B8FF">10.0</span><span style="color:#E1E4E8">, </span><span style="color:#79B8FF">true</span><span style="color:#E1E4E8">),</span></span>
<span class="line"><span style="color:#F97583">                new</span><span style="color:#B392F0"> ProductDto</span><span style="color:#E1E4E8">(</span><span style="color:#79B8FF">2</span><span style="color:#E1E4E8">, </span><span style="color:#9ECBFF">"Product 2"</span><span style="color:#E1E4E8">, </span><span style="color:#9ECBFF">"Description 2"</span><span style="color:#E1E4E8">, </span><span style="color:#79B8FF">20.0</span><span style="color:#E1E4E8">, </span><span style="color:#79B8FF">true</span><span style="color:#E1E4E8">)</span></span>
<span class="line"><span style="color:#E1E4E8">        );</span></span>
<span class="line"><span style="color:#B392F0">        when</span><span style="color:#E1E4E8">(mockRemoteDataSource.</span><span style="color:#B392F0">getProducts</span><span style="color:#E1E4E8">()).</span><span style="color:#B392F0">thenReturn</span><span style="color:#E1E4E8">(remoteDtos);</span></span>
<span class="line"><span style="color:#E1E4E8">        </span></span>
<span class="line"><span style="color:#6A737D">        // Act</span></span>
<span class="line"><span style="color:#E1E4E8">        List&#x3C;</span><span style="color:#F97583">Product</span><span style="color:#E1E4E8">> products </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> repository.</span><span style="color:#B392F0">getProducts</span><span style="color:#E1E4E8">();</span></span>
<span class="line"><span style="color:#E1E4E8">        </span></span>
<span class="line"><span style="color:#6A737D">        // Assert</span></span>
<span class="line"><span style="color:#B392F0">        verify</span><span style="color:#E1E4E8">(mockRemoteDataSource).</span><span style="color:#B392F0">getProducts</span><span style="color:#E1E4E8">();</span></span>
<span class="line"><span style="color:#B392F0">        assertEquals</span><span style="color:#E1E4E8">(</span><span style="color:#79B8FF">2</span><span style="color:#E1E4E8">, products.</span><span style="color:#B392F0">size</span><span style="color:#E1E4E8">());</span></span>
<span class="line"><span style="color:#B392F0">        assertEquals</span><span style="color:#E1E4E8">(</span><span style="color:#79B8FF">1</span><span style="color:#E1E4E8">, products.</span><span style="color:#B392F0">get</span><span style="color:#E1E4E8">(</span><span style="color:#79B8FF">0</span><span style="color:#E1E4E8">).</span><span style="color:#B392F0">getId</span><span style="color:#E1E4E8">());</span></span>
<span class="line"><span style="color:#B392F0">        assertEquals</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">"Product 1"</span><span style="color:#E1E4E8">, products.</span><span style="color:#B392F0">get</span><span style="color:#E1E4E8">(</span><span style="color:#79B8FF">0</span><span style="color:#E1E4E8">).</span><span style="color:#B392F0">getName</span><span style="color:#E1E4E8">());</span></span>
<span class="line"><span style="color:#E1E4E8">    }</span></span>
<span class="line"><span style="color:#E1E4E8">    </span></span>
<span class="line"><span style="color:#E1E4E8">    @</span><span style="color:#F97583">Test</span></span>
<span class="line"><span style="color:#F97583">    public</span><span style="color:#F97583"> void</span><span style="color:#B392F0"> getProducts_remoteFails_fallbackToLocal</span><span style="color:#E1E4E8">() </span><span style="color:#F97583">throws</span><span style="color:#E1E4E8"> Exception {</span></span>
<span class="line"><span style="color:#6A737D">        // Arrange</span></span>
<span class="line"><span style="color:#B392F0">        when</span><span style="color:#E1E4E8">(mockRemoteDataSource.</span><span style="color:#B392F0">getProducts</span><span style="color:#E1E4E8">()).</span><span style="color:#B392F0">thenThrow</span><span style="color:#E1E4E8">(</span><span style="color:#F97583">new</span><span style="color:#B392F0"> IOException</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">"Network error"</span><span style="color:#E1E4E8">));</span></span>
<span class="line"><span style="color:#E1E4E8">        </span></span>
<span class="line"><span style="color:#E1E4E8">        List&#x3C;</span><span style="color:#F97583">ProductDto</span><span style="color:#E1E4E8">> localDtos </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> Arrays.</span><span style="color:#B392F0">asList</span><span style="color:#E1E4E8">(</span></span>
<span class="line"><span style="color:#F97583">                new</span><span style="color:#B392F0"> ProductDto</span><span style="color:#E1E4E8">(</span><span style="color:#79B8FF">1</span><span style="color:#E1E4E8">, </span><span style="color:#9ECBFF">"Product 1"</span><span style="color:#E1E4E8">, </span><span style="color:#9ECBFF">"Description 1"</span><span style="color:#E1E4E8">, </span><span style="color:#79B8FF">10.0</span><span style="color:#E1E4E8">, </span><span style="color:#79B8FF">true</span><span style="color:#E1E4E8">)</span></span>
<span class="line"><span style="color:#E1E4E8">        );</span></span>
<span class="line"><span style="color:#B392F0">        when</span><span style="color:#E1E4E8">(mockLocalDataSource.</span><span style="color:#B392F0">getProducts</span><span style="color:#E1E4E8">()).</span><span style="color:#B392F0">thenReturn</span><span style="color:#E1E4E8">(localDtos);</span></span>
<span class="line"><span style="color:#E1E4E8">        </span></span>
<span class="line"><span style="color:#6A737D">        // Act</span></span>
<span class="line"><span style="color:#E1E4E8">        List&#x3C;</span><span style="color:#F97583">Product</span><span style="color:#E1E4E8">> products </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> repository.</span><span style="color:#B392F0">getProducts</span><span style="color:#E1E4E8">();</span></span>
<span class="line"><span style="color:#E1E4E8">        </span></span>
<span class="line"><span style="color:#6A737D">        // Assert</span></span>
<span class="line"><span style="color:#B392F0">        verify</span><span style="color:#E1E4E8">(mockRemoteDataSource).</span><span style="color:#B392F0">getProducts</span><span style="color:#E1E4E8">();</span></span>
<span class="line"><span style="color:#B392F0">        verify</span><span style="color:#E1E4E8">(mockLocalDataSource).</span><span style="color:#B392F0">getProducts</span><span style="color:#E1E4E8">();</span></span>
<span class="line"><span style="color:#B392F0">        assertEquals</span><span style="color:#E1E4E8">(</span><span style="color:#79B8FF">1</span><span style="color:#E1E4E8">, products.</span><span style="color:#B392F0">size</span><span style="color:#E1E4E8">());</span></span>
<span class="line"><span style="color:#E1E4E8">    }</span></span>
<span class="line"><span style="color:#E1E4E8">}</span></span></code></pre>
<h2 id="complete-architecture-example">Complete Architecture Example</h2>
<p>Here’s how all the pieces come together in a multi-screen application:</p>
<p><img src="https://github.com/android/architecture-samples/raw/dev-todo-mvvm-live/todoapp/docs/images/architecture.png" alt="Complete Architecture Diagram"></p>
<h3 id="application-flow">Application Flow</h3>
<ol>
<li>User interacts with the UI (Fragment/Activity)</li>
<li>UI passes events to ViewModel</li>
<li>ViewModel executes use cases/interacts with repositories</li>
<li>Repository fetches data from local or remote data sources</li>
<li>Data flows back through the chain: Repository → ViewModel → UI</li>
<li>UI updates based on the new data</li>
</ol>
<h3 id="sample-multi-screen-application">Sample Multi-Screen Application</h3>
<p>A typical multi-screen e-commerce app might have:</p>
<ol>
<li>
<p><strong>Product List Screen</strong></p>
<ul>
<li>Shows a list of products</li>
<li>Allows filtering and sorting</li>
<li>Navigate to product details on click</li>
</ul>
</li>
<li>
<p><strong>Product Detail Screen</strong></p>
<ul>
<li>Shows detailed product information</li>
<li>Allows adding to cart</li>
<li>Shows related products</li>
</ul>
</li>
<li>
<p><strong>Shopping Cart Screen</strong></p>
<ul>
<li>Shows items in cart</li>
<li>Allows changing quantities</li>
<li>Calculates total price</li>
<li>Proceeds to checkout</li>
</ul>
</li>
<li>
<p><strong>Checkout Screen</strong></p>
<ul>
<li>Enter shipping information</li>
<li>Select payment method</li>
<li>Complete order</li>
</ul>
</li>
</ol>
<p>Each screen would have its own Fragment, ViewModel, and potentially domain-specific use cases, all sharing common repositories and data sources.</p>
<h2 id="best-practices">Best Practices</h2>
<ol>
<li>
<p><strong>Use Single-Activity Architecture</strong></p>
<ul>
<li>One main activity with multiple fragments</li>
<li>Use Navigation Component for transitions</li>
</ul>
</li>
<li>
<p><strong>ViewModels Should Be Independent</strong></p>
<ul>
<li>Don’t share ViewModels between unrelated screens</li>
<li>Use SavedStateHandle for process death</li>
</ul>
</li>
<li>
<p><strong>Repository as Single Source of Truth</strong></p>
<ul>
<li>All data operations go through repositories</li>
<li>Repositories decide which data source to use</li>
</ul>
</li>
<li>
<p><strong>Room for Local Persistence</strong></p>
<ul>
<li>Use Room for structured data storage</li>
<li>Define clear entities and relations</li>
</ul>
</li>
<li>
<p><strong>Main Thread Safety</strong></p>
<ul>
<li>Use background threads or coroutines for I/O operations</li>
<li>Update LiveData on main thread</li>
</ul>
</li>
<li>
<p><strong>Clear Separation Between Layers</strong></p>
<ul>
<li>UI layer shouldn’t know about data sources</li>
<li>Domain layer shouldn’t depend on Android</li>
</ul>
</li>
<li>
<p><strong>Use DTOs for Network/Database</strong></p>
<ul>
<li>Separate data models for network/database</li>
<li>Map to domain models in repositories</li>
</ul>
</li>
<li>
<p><strong>Error Handling Strategy</strong></p>
<ul>
<li>Define clear error types</li>
<li>Provide user-friendly error messages</li>
</ul>
</li>
<li>
<p><strong>Unit Tests for Each Layer</strong></p>
<ul>
<li>Test ViewModels, repositories, and use cases independently</li>
<li>Use mock dependencies for isolation</li>
</ul>
</li>
<li>
<p><strong>UI Testing for Critical Flows</strong></p>
<ul>
<li>Test end-to-end user journeys</li>
<li>Verify UI behavior and navigation</li>
</ul>
</li>
</ol>
<p>By following these architecture patterns and best practices, you can build a robust, maintainable, and testable multi-screen Android application that can scale with your requirements.</p> </div> </div> <div class="post-navigation" data-astro-cid-4sn4zg3r> <a href="/blog/android-rest-api-tutorial" class="nav-prev" data-astro-cid-4sn4zg3r> <span class="nav-label" data-astro-cid-4sn4zg3r><span class="prompt" data-astro-cid-4sn4zg3r>$</span> cd prev</span> <span class="nav-title" data-astro-cid-4sn4zg3r>Android REST API Calls with Progress Indicators: A Complete Guide</span> </a> <a href="/blog" class="nav-home" data-astro-cid-4sn4zg3r> <span class="prompt" data-astro-cid-4sn4zg3r>$</span> cd ~/blog
</a>  </div> </article>  </main> </div> <style>astro-island,astro-slot,astro-static-slot{display:contents}</style><script>(()=>{var e=async t=>{await(await t())()};(self.Astro||(self.Astro={})).load=e;window.dispatchEvent(new Event("astro:load"));})();;(()=>{var A=Object.defineProperty;var g=(i,o,a)=>o in i?A(i,o,{enumerable:!0,configurable:!0,writable:!0,value:a}):i[o]=a;var d=(i,o,a)=>g(i,typeof o!="symbol"?o+"":o,a);{let i={0:t=>m(t),1:t=>a(t),2:t=>new RegExp(t),3:t=>new Date(t),4:t=>new Map(a(t)),5:t=>new Set(a(t)),6:t=>BigInt(t),7:t=>new URL(t),8:t=>new Uint8Array(t),9:t=>new Uint16Array(t),10:t=>new Uint32Array(t),11:t=>1/0*t},o=t=>{let[l,e]=t;return l in i?i[l](e):void 0},a=t=>t.map(o),m=t=>typeof t!="object"||t===null?t:Object.fromEntries(Object.entries(t).map(([l,e])=>[l,o(e)]));class y extends HTMLElement{constructor(){super(...arguments);d(this,"Component");d(this,"hydrator");d(this,"hydrate",async()=>{var b;if(!this.hydrator||!this.isConnected)return;let e=(b=this.parentElement)==null?void 0:b.closest("astro-island[ssr]");if(e){e.addEventListener("astro:hydrate",this.hydrate,{once:!0});return}let c=this.querySelectorAll("astro-slot"),n={},h=this.querySelectorAll("template[data-astro-template]");for(let r of h){let s=r.closest(this.tagName);s!=null&&s.isSameNode(this)&&(n[r.getAttribute("data-astro-template")||"default"]=r.innerHTML,r.remove())}for(let r of c){let s=r.closest(this.tagName);s!=null&&s.isSameNode(this)&&(n[r.getAttribute("name")||"default"]=r.innerHTML)}let p;try{p=this.hasAttribute("props")?m(JSON.parse(this.getAttribute("props"))):{}}catch(r){let s=this.getAttribute("component-url")||"<unknown>",v=this.getAttribute("component-export");throw v&&(s+=` (export ${v})`),console.error(`[hydrate] Error parsing props for component ${s}`,this.getAttribute("props"),r),r}let u;await this.hydrator(this)(this.Component,p,n,{client:this.getAttribute("client")}),this.removeAttribute("ssr"),this.dispatchEvent(new CustomEvent("astro:hydrate"))});d(this,"unmount",()=>{this.isConnected||this.dispatchEvent(new CustomEvent("astro:unmount"))})}disconnectedCallback(){document.removeEventListener("astro:after-swap",this.unmount),document.addEventListener("astro:after-swap",this.unmount,{once:!0})}connectedCallback(){if(!this.hasAttribute("await-children")||document.readyState==="interactive"||document.readyState==="complete")this.childrenConnectedCallback();else{let e=()=>{document.removeEventListener("DOMContentLoaded",e),c.disconnect(),this.childrenConnectedCallback()},c=new MutationObserver(()=>{var n;((n=this.lastChild)==null?void 0:n.nodeType)===Node.COMMENT_NODE&&this.lastChild.nodeValue==="astro:end"&&(this.lastChild.remove(),e())});c.observe(this,{childList:!0}),document.addEventListener("DOMContentLoaded",e)}}async childrenConnectedCallback(){let e=this.getAttribute("before-hydration-url");e&&await import(e),this.start()}async start(){let e=JSON.parse(this.getAttribute("opts")),c=this.getAttribute("client");if(Astro[c]===void 0){window.addEventListener(`astro:${c}`,()=>this.start(),{once:!0});return}try{await Astro[c](async()=>{let n=this.getAttribute("renderer-url"),[h,{default:p}]=await Promise.all([import(this.getAttribute("component-url")),n?import(n):()=>()=>{}]),u=this.getAttribute("component-export")||"default";if(!u.includes("."))this.Component=h[u];else{this.Component=h;for(let f of u.split("."))this.Component=this.Component[f]}return this.hydrator=p,this.hydrate},e,this)}catch(n){console.error(`[astro-island] Error hydrating ${this.getAttribute("component-url")}`,n)}}attributeChangedCallback(){this.hydrate()}}d(y,"observedAttributes",["props"]),customElements.get("astro-island")||customElements.define("astro-island",y)}})();</script><astro-island uid="1lalxh" prefix="r0" component-url="/_astro/Terminal.B48kxAFY.js" component-export="default" renderer-url="/_astro/client.BO3Rm8ny.js" props="{}" ssr client="load" opts="{&quot;name&quot;:&quot;Terminal&quot;,&quot;value&quot;:true}" await-children><div class="terminal-container terminal-open"><div class="terminal-header"><div class="terminal-title">Terminal</div><div class="terminal-controls"><span class="terminal-minimize"></span><span class="terminal-maximize"></span><span class="terminal-close"></span></div></div><div class="terminal-body"><div class="terminal-welcome">Welcome to a terminal@pnbe! Type &#x27;help&#x27; for available commands. You can navigate the entire site using this terminal (or at least that&#x27;s the idea).</div><div class="terminal-input-line"><span class="terminal-prompt">guest@terminal:~$ </span><input type="text" class="terminal-input" value=""/></div></div></div><!--astro:end--></astro-island> <astro-island uid="ZBzTnl" prefix="r1" component-url="/_astro/ToggleTerminal.biyOownL.js" component-export="default" renderer-url="/_astro/client.BO3Rm8ny.js" props="{}" ssr client="load" opts="{&quot;name&quot;:&quot;ToggleTerminal&quot;,&quot;value&quot;:true}" await-children><button class="terminal-toggle" aria-label="Toggle Terminal">Terminal <span class="shortcut">(Ctrl+`)</span></button><!--astro:end--></astro-island> </div> <script type="module">document.addEventListener("keydown",e=>{e.ctrlKey&&e.key==="`"&&(document.querySelector(".terminal-container").classList.toggle("terminal-open"),e.preventDefault())});</script> </body> </html> 